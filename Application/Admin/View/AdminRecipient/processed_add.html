<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <style type="text/css">
      body {
        padding-top: 40px;
        padding-bottom: 40px;
        background-color: #f5f5f5;

      }

      .container{margin:0 auto;}
      .form-signin {
        max-width: 900px;
        margin-top:60px;
        background-color: #fff;
        border: 1px solid #e5e5e5;
        -webkit-border-radius: 5px;
           -moz-border-radius: 5px;
                border-radius: 5px;
        -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);
           -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);
                box-shadow: 0 1px 2px rgba(0,0,0,.05);
      }
    .form-signin table th{height:36px;font-size:16px;line-height:36px;background:#F7F7F9;}
    .form-signin table td{height:36px;line-height:36px;font-size:14px;text-indent:2em;background:#F7F7F9;}
    .form-signin table td a{text-decoration:none;color:#000;}
    .form-signin table td a:hover{color:blue;}
    .form-signin .form-control{width:400px !important;}
    </style>
    <link href="__PUBLIC__/css/one.css" rel="stylesheet">  
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.bootcss.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->
     </head>
  <body>

    <div class="container" >
      <div class="form-signin" style="padding-top:40px;background:#F7F7F9 !important;margin-bottom:40px">

					<form class="form-horizontal" action="{:U('AdminRecipient/audit')}" method='post' enctype="multipart/form-data"  id="tempForm" >
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">会员账号:</label>
								<div class="col-sm-5" >
									<input type="text"  name="user_name" placeholder="会员账号" class="form-control">
								</div>
							<label class="col-sm-2 control-label"></label>
						</div>
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">订单号:</label>
								<div class="col-sm-5" >
									<input type="text"  name="orderno" placeholder="会员订单号" class="form-control">
								</div>
							<label class="col-sm-2 control-label"></label>
						</div>
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证名称:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['true_name']}
								</div>
								<else />
								<div class="col-sm-5" id ="true_name">
									<input type="text" value="{$data['true_name']}" name="true_name" placeholder="收件人名称" class="form-control">
								</div>
							</if>

							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">证件号码:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['idno']}
								</div>
								<else />
								<div class="col-sm-5" id ="idno">
									<input type="text" value="{$data['idno']}" name="idno"  placeholder="证件号码"  class="form-control">
								</div>
							</if>
							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">手机号码:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['tel']}
								</div>
								<else />
								<div class="col-sm-5" id ="tel">
									<input type="text" value="{$data['tel']}" name="tel" class="form-control">
								</div>
							</if>
							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">性别:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['sex']}
								</div>
								<else />
								<div class="col-sm-5" id ="sex">
									<input type="text" value="{$data['sex']}" name="sex" class="form-control">
								</div>
							</if>

							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">民族:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['nation']}
								</div>
								<else />
								<div class="col-sm-5" id="nation">
									<input type="text" value="{$data['nation']}" name="nation" class="form-control" />
								</div>
							</if>

							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">出生日期:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['birth']}
								</div>
								<else />
								<div class="col-sm-5" id="birth">
									<input type="text" value="{$data['birth']}" name="birth" class="form-control" />
								</div>
							</if>
							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证地址:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['address']}
								</div>
								<else />
								<div class="col-sm-5" id="address">
									<input type="text" value="{$data['address']}" name="address" class="form-control" />
								</div>
							</if>
							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证发证机关:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['authority']}
								</div>
								<else />
								<div class="col-sm-5" id="authority">
									<input type="text" value="{$data['authority']}" name="authority" class="form-control" />
								</div>
							</if>
							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证有效开始时间:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['valid_date_start']}
								</div>
								<else />
								<div class="col-sm-5" id="valid_date_start">
									<input type="text" value="{$data['valid_date_start']}" name="valid_date_start" class="form-control" />
								</div>
							</if>
							<label class="col-sm-2 control-label"></label>
						</div>

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证有效结束时间:</label>
							<if condition="$data['status'] eq 10">
								<div class="col-sm-5">
									{$data['valid_date_end']}
								</div>
								<else />
								<div class="col-sm-5" id="valid_date_end">
									<input type="text" value="{$data['valid_date_end']}" name="valid_date_end" class="form-control" />
								</div>
							</if>

							<label class="col-sm-2 control-label"></label>
						</div>





						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证国徽面:</label>
							<div class="col-sm-5">
								<input type="file" name="id_card_front"  id="front_id_img" />
							</div>
							<label class="col-sm-2 control-label"></label>
						</div>
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证头像面:</label>
							<div class="col-sm-5">
								<input type="file" name="id_card_back" id="back_id_img" />
							</div>
							<!-- <div class="col-sm-5">
								<img src="http://test-1251583197.cosgz.myqcloud.com/test/qwe.jpg" />
							</div> -->
							<label class="col-sm-2 control-label"></label>
						</div>
						

						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证合成图:</label>
							<div class="col-sm-5">
								<input type="file" name="id_imgs"  id="pic"  />
							</div>
							<label class="col-sm-2 control-label"></label>
						</div>

<!--
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">是否审核通过:</label>
							<div class="col-sm-5">
								<input name="status" value="0" checked="checked"  type="radio">
								未审核
								<input name="status" value="2"  type="radio">
								未通过审核
								<input name="status" value="10"  type="radio">
								已通过审核
							</div>
							<label class="col-sm-2 control-label"></label>
						</div>
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">身份证是否失效:</label>
							<div class="col-sm-5">
								<input name="idcard_status" value="1"  checked="checked"  type="radio">
								否
								<input name="idcard_status" value="2"  type="radio">
								是
							</div>
							<label class="col-sm-2 control-label"></label>
						</div>
-->

							<div class="form-group">
								<label for="username" class="col-sm-2 control-label">是否修改订单身份证信息:</label>
								<div class="col-sm-5">
									<input name="more" value="1"  checked="checked"  type="radio">
									否
									<input name="more" value="2"  type="radio">
									是
								</div>
								<label class="col-sm-2 control-label"></label>
							</div>



						<div class="form-group">
							<label class="col-sm-2 control-label"></label>
							<div class="col-sm-10">
								<if condition="$data['status'] neq 10">	
									<button type="button" class="btn btn-success btn-add card"  id="BtnSave">添加</button>
								</if>
								<button id="beClosed" class="btn btn-default" type="button" data-dismiss="modal">关闭</button>
								<input	type="hidden" name="id" value="{$data['id']}" />
								<span id="messagebox" class="msgbox" style="  right:300px;!important"></span>
							</div>
							
						</div>

					</form>

 <script type="text/javascript">  
 onload = window.document.getElementById("eject").style.width= "940px";;
 
 function out(i){  
     var v = i.validity;  
     if(true === v.valueMessing){  
         i.setCustomValidity("请填写此字段");  
     }else{  
         if(true === v.patternMismatch){  

             i.setCustomValidity("最多6个字母或数字，不能为中文");  
         }else{  
             i.setCustomValidity("");  
         }  
     }  
 }  



	function ityzl_SHOW_LOAD_LAYER(){  
	    return layer.msg('努力中...', {icon: 16,shade: [0.5, '#f5f5f5'],scrollbar: false,offset: '200px', time:100000}) ;  
	}  
	function ityzl_CLOSE_LOAD_LAYER(index){  
	    layer.close(index);  
	}  
	function ityzl_SHOW_TIP_LAYER(str, url = ''){  
	    layer.msg(''+str+'',{time: 2000,offset: '200px'}); 
	    if(url){
	    	window.location = url;
	    }else{
	    	window.location.reload(); 
	    }
	}

	 function ityzl_SHOW_TIP_LAYER_STR(str){
		 layer.msg(''+str+'',{time: 2000,offset: '200px'});

	 }

	 $('.card').click(function(){

		 var user_name = $(':input[name="user_name"]').val();
         var orderno = $(':input[name="orderno"]').val();
         var more = $(':input[name="more"]:checked').val();
         if(typeof(user_name) == 'undefined' && typeof (orderno) == 'undefined'){
				alert('请输入会员账号或订单号');
				return
         }
         var status = $(':input[name="status"]:checked').val();
		 var id = $(':input[name="id"]').val();
		 var idcard_status = $(':input[name="idcard_status"]:checked').val();
		 var pic = document.getElementById('pic');
		 var card_pic = pic.files['0'];
		 if(document.getElementById('back_id_img')){
			 var back_id_img_id = document.getElementById('back_id_img');
			 var back_id_img = back_id_img_id.files['0'];
		 }
		 if(document.getElementById('front_id_img')){
			 var front_id_img_id = document.getElementById('front_id_img');
			 var front_id_img = front_id_img_id.files['0'];
		 }

		 var true_name  		= $(':input[name="true_name"]').val();
		 var idno 			= $(':input[name="idno"]').val();
		 var tel 			= $(':input[name="tel"]').val();
		 var sex 			= $(':input[name="sex"]').val();
		 var nation 			= $(':input[name="nation"]').val();
		 var birth 			= $(':input[name="birth"]').val();
		 var address   		= $(':input[name="address"]').val();
		 var authority 		= $(':input[name="authority"]').val();
		 var valid_date_start  = $(':input[name="valid_date_start"]').val();
		 var valid_date_end  = $(':input[name="valid_date_end"]').val();

		 //if(status == 'undefined'){
		 //    alert('请选择审核状态！');
		 //    return;
		 //}
		 var formData = new FormData();
		 formData.append("id", id);
         if(typeof (more) != 'undefined'){
             formData.append("more", more);
         }
         if(typeof(user_name) != 'undefined'){
             formData.append("user_name", user_name);
         }
         if(typeof(orderno) != 'undefined'){
             formData.append("orderno", orderno);
         }
         if(typeof(true_name) != 'undefined'){
             formData.append("true_name", true_name);
         }
         if(typeof(true_name) != 'undefined'){
             formData.append("true_name", true_name);
         }

         if(typeof(true_name) != 'undefined'){
			 formData.append("true_name", true_name);
		 }
		 if(typeof(idno) != 'undefined'){
			 formData.append("idno", idno);
		 }
		 if(typeof(tel) != 'undefined' && tel != ''){
			 formData.append("tel", tel);
		 }else{
             alert('请输入收件人手机号码！');
             return;
		 }
		 if(typeof(sex) != 'undefined'){
			 formData.append("sex", sex);
		 }
		 if(typeof(nation) != 'undefined'){
			 formData.append("nation", nation);
		 }
		 if(typeof(birth) != 'undefined'){
			 formData.append("birth", birth);
		 }
		 if(typeof(address) != 'undefined'){
			 formData.append("address", address);
		 }

		 if(typeof(authority) != 'undefined'){
			 formData.append("authority", authority);
		 }
		 if(typeof(valid_date_end) != 'undefined'){
			 formData.append("valid_date_end", valid_date_end);
		 }
		 if(typeof (valid_date_start) != 'undefined'){
			 formData.append("valid_date_start", valid_date_start);
		 }


		 if(typeof(status) != 'undefined'){
			 formData.append("status", status);
		 }
		 formData.append("idcard_status", idcard_status);
		 if(card_pic != 'undefined'){
			 formData.append("id_imgs", card_pic);
		 }
		 if(back_id_img != 'undefined'){
			 formData.append("back_id_img", back_id_img);
		 }
		 if(front_id_img != 'undefined'){
			 formData.append("front_id_img", front_id_img);
		 }

		 var request;
		 if (window.XMLHttpRequest) {
			 request = new XMLHttpRequest();
		 } else {
			 request = new ActiveXObject('Microsoft.XMLHTTP');
		 }
		 var i;
		 ityzl_SHOW_LOAD_LAYER();
		 request.onreadystatechange = function(){
			 if(request.status == 200 && request.readyState == 4){
				 if(request.responseText){
					 //成功返回
					 var a = JSON.parse( request.responseText );
					 var status = a.status;
					 var str = a.data.strstr;
					 var url = a.data.url;
					 ityzl_CLOSE_LOAD_LAYER(i);
					 ityzl_SHOW_TIP_LAYER(str, url);
					 var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
					 //var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
					 parent.layer.msg(str);
					 parent.location.reload();
					 parent.layer.close(index);

					 //parent.layer.close(str); //再执行关闭
					 ityzl_SHOW_TIP_LAYER(str, url);
					 //document.getElementById("form2").reset();
				 }else{
					 ityzl_CLOSE_LOAD_LAYER(i);
				 }
			 }
		 }
		 request.open("post", "{:U('AdminRecipient/process_handle')}");
		 //request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		 request.setRequestHeader("X-Requested-With","XMLHttpRequest");
		 request.send(formData);
		 // 上传代码返回结果之后，将图片插入到编辑器中



		 //$('form').submit();
	 });

	 $('#back_id_img').change(function(){
		 //alert('3233');
		 var id   =  $(':input[name="id"]').val();
		 var more = $(':input[name="more"]:checked').val();
		 var back_id_img_id = document.getElementById('back_id_img');
		 var back_id_img = back_id_img_id.files['0'];

		 var formData = new FormData();
		 formData.append("id", id);
		 if(typeof (more) != 'undefined'){
			 formData.append("more", more);
		 }
		 if(back_id_img != 'undefined'){
			 formData.append("back_id_img", back_id_img);
			 var request;
			 if (window.XMLHttpRequest) {
				 request = new XMLHttpRequest();
			 }else{
				 request = new ActiveXObject('Microsoft.XMLHTTP');
			 }
			 var i;
			 ityzl_SHOW_LOAD_LAYER();
			 request.onreadystatechange = function(){
				 if(request.status == 200 && request.readyState == 4){
					 if(request.responseText){
						 //成功返回
						 var a = JSON.parse( request.responseText );
						 var status = a.status;
						 var emptys = a.data.emptys;
						 var str = a.data.strstr;
						 //不用再次识别，提示信息
						 if(emptys == 1){
							 var files = $("#back_id_img").val('');
							 //files.after(files.clone().val(""));
							 //files.remove();
							 ityzl_CLOSE_LOAD_LAYER(i);
							 ityzl_SHOW_TIP_LAYER_STR(str);
							 return;
						 }

						 if(status == 1){
							 var dis = a.data.distinguish;
							 true_name_html 		= '<input type="text" value="'+dis.true_name+'" name="true_name" class="form-control" />';
							 sex_html 				= '<input type="text" value="'+dis.sex+'" name="sex" class="form-control" />';
							 nation_html 			= '<input type="text" value="'+dis.nation+'" name="nation" class="form-control" />';
							 birth_html 			= '<input type="text" value="'+dis.birth+'" name="birth" class="form-control" />';
							 address_html 			= '<input type="text" value="'+dis.address+'" name="address" class="form-control" />';
							 idno_html 				= '<input type="text" value="'+dis.idno+'" name="idno" class="form-control" />';

							 $('#true_name').html(true_name_html);
							 $('#sex').html(sex_html);
							 $('#nation').html(nation_html);
							 $('#birth').html(birth_html);
							 $('#address').html(address_html);
							 $('#idno').html(idno_html);

						 }

						 var url = a.data.url;
						 ityzl_CLOSE_LOAD_LAYER(i);
						 ityzl_SHOW_TIP_LAYER_STR(str);

					 }else{
						 ityzl_CLOSE_LOAD_LAYER(i);
					 }
				 }
			 }
			 request.open("post", "{:U('AdminRecipient/BackDistinguish')}");
			 //request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			 request.setRequestHeader("X-Requested-With","XMLHttpRequest");
			 request.send(formData);
		 }else {
			 alert('请上传身份证!');
		 }
	 });



	 $('#front_id_img').change(function(){
		 var id   =  $(':input[name="id"]').val();
		 var more = $(':input[name="more"]:checked').val();

		 var front_id_img_id = document.getElementById('front_id_img');
		 var front_id_img = front_id_img_id.files['0'];
		 var formData = new FormData();
		 formData.append("id", id);
		 if(typeof (more) != 'undefined'){
			 formData.append("more", more);
		 }
		 if(front_id_img != 'undefined'){
			 formData.append("front_id_img", front_id_img);
			 var request;
			 if (window.XMLHttpRequest) {
				 request = new XMLHttpRequest();
			 } else {
				 request = new ActiveXObject('Microsoft.XMLHTTP');
			 }
			 var i;
			 ityzl_SHOW_LOAD_LAYER();
			 request.onreadystatechange = function(){
				 if(request.status == 200 && request.readyState == 4){
					 if(request.responseText){
						 //成功返回
						 var a = JSON.parse( request.responseText );
						 var status = a.status;
						 var emptys = a.data.emptys;
						 var str = a.data.strstr;
						 //不用再次识别，提示信息
						 if(emptys == 1){
							 var files = $("#front_id_img").val('');
							 //files.after(files.clone().val(""));
							 //files.remove();
							 ityzl_CLOSE_LOAD_LAYER(i);
							 ityzl_SHOW_TIP_LAYER_STR(str);
							 return;
						 }
						 if(status == 1){
							 var dis = a.data.distinguish;
							 authority_html 			= '<input type="text" value="'+dis.authority+'" name="authority" class="form-control" />';
							 valid_date_start_html 	= '<input type="text" value="'+dis.valid_date_start+'" name="valid_date_start" class="form-control" />';
							 valid_date_end_html 		= '<input type="text" value="'+dis.valid_date_end+'" name="valid_date_end" class="form-control" />';

							 $('#authority').html(authority_html);
							 $('#valid_date_start').html(valid_date_start_html);
							 $('#valid_date_end').html(valid_date_end_html);


						 }

						 var url = a.data.url;
						 ityzl_CLOSE_LOAD_LAYER(i);
						 ityzl_SHOW_TIP_LAYER_STR(str);

					 }else{
						 ityzl_CLOSE_LOAD_LAYER(i);
					 }
				 }
			 }
			 request.open("post", "{:U('AdminRecipient/FrontDistinguish')}");
			 //request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			 request.setRequestHeader("X-Requested-With","XMLHttpRequest");
			 request.send(formData);
		 }else {
			 alert('请上传身份证!');
		 }
	 });








 </script> 
      </div>
    </div> 
 
  </body>
<script src="__PUBLIC__/js/my.js"></script>
</html>