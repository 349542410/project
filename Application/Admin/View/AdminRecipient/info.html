<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <style type="text/css">
    body {
      padding-top: 40px;
      padding-bottom: 40px;
      background-color: #f5f5f5;

    }

    .container {
      margin: 0 auto;
    }

    .form-signin {
      max-width: 900px;
      margin-top: 60px;
      background-color: #fff;
      border: 1px solid #e5e5e5;
      -webkit-border-radius: 5px;
      -moz-border-radius: 5px;
      border-radius: 5px;
      -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
      -moz-box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    }

    .form-signin table th {
      height: 36px;
      font-size: 16px;
      line-height: 36px;
      background: #F7F7F9;
    }

    .form-signin table td {
      height: 36px;
      line-height: 36px;
      font-size: 14px;
      text-indent: 2em;
      background: #F7F7F9;
    }

    .form-signin table td a {
      text-decoration: none;
      color: #000;
    }

    .form-signin table td a:hover {
      color: blue;
    }

    .form-signin .form-control {
      width: 400px !important;
    }
  </style>
  <link href="__PUBLIC__/css/one.css" rel="stylesheet">
  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
	<script src="//cdnjs.bootcss.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
	<![endif]-->
  <!-- 截图，上传图片引入文件 -->
  <link rel="stylesheet" href="__PUBLIC__/css/cropper.css">
  <link rel="stylesheet" href="__PUBLIC__/css/cutOutPic.css">

</head>

<body>

  <div class="container">
    <div class="form-signin" style="padding-top:40px;background:#F7F7F9 !important;margin-bottom:40px">

      <form class="form-horizontal" action="{:U('AdminRecipient/audit')}" method='post' enctype="multipart/form-data" id="tempForm">
        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证名称:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['true_name']}
            </div>
            <else />
            <div class="col-sm-5">
              <input type="text" value="{$data['true_name']}" name="true_name" disabled="true" class="form-control">
            </div>
          </if>

          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">证件号码:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['idno']}
            </div>
            <else />
            <div class="col-sm-5">
              <input type="text" value="{$data['idno']}" name="idno"  disabled="true" class="form-control">
            </div>
          </if>
          <label class="col-sm-2 control-label"></label>
        </div>


        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">手机号码:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['tel']}
            </div>
            <else />
            <div class="col-sm-5" id="tel">
              <input type="text" value="{$data['tel']}" name="tel" class="form-control">
            </div>
          </if>
          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">性别:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['sex']}
            </div>
            <else />
            <div class="col-sm-5" id="sex">
              <input type="text" value="{$data['sex']}" name="sex" class="form-control">
            </div>
          </if>

          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">民族:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['nation']}
            </div>
            <else />
            <div class="col-sm-5" id="nation">
              <input type="text" value="{$data['nation']}" name="nation" class="form-control" />
            </div>
          </if>

          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">出生日期:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['birth']}
            </div>
            <else />
            <div class="col-sm-5" id="birth">
              <input type="text" value="{$data['birth']}" name="birth" class="form-control" />
            </div>
          </if>
          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证地址:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['address']}
            </div>
            <else />
            <div class="col-sm-5" id="address">
              <input type="text" value="{$data['address']}" name="address" class="form-control" />
            </div>
          </if>
          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证发证机关:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['authority']}
            </div>
            <else />
            <div class="col-sm-5" id="authority">
              <input type="text" value="{$data['authority']}" name="authority" class="form-control" />
            </div>
          </if>
          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证有效开始时间:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['valid_date_start']}
            </div>
            <else />
            <div class="col-sm-5" id="valid_date_start">
              <input type="text" value="{$data['valid_date_start']}" name="valid_date_start" class="form-control" />
            </div>
          </if>
          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证有效结束时间:</label>
          <if condition="$data['status'] eq 10">
            <div class="col-sm-5">
              {$data['valid_date_end']}
            </div>
            <else />
            <div class="col-sm-5" id="valid_date_end">
              <input type="text" value="{$data['valid_date_end']}" name="valid_date_end" class="form-control" />
            </div>
          </if>

          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证国徽面:</label>
          <div class="col-sm-5">
            <!-- <if condition="$data['front_id_img'] neq ''">
                        <img src="{$wu_file}{$data['front_id_img']}" width="150" height="90"/>
                    </if> -->
            <if condition="$data['front_id_img'] neq ''">
              <a href="{$wu_file}{$data.front_id_img}" target="_blank" style="display:inline;">
                <img alt="" src="{$wu_file}{$data.front_id_img}" width="100" height="80" id="originalFrontIdImg" />
              </a>
              <else />
              <a href="__PUBLIC__/images/pho_front.png" target="_blank" style="display:inline;">
                <img src="__PUBLIC__/images/pho_front.png" width="100" height="80" />
              </a>
            </if>
          </div>
          <label class="col-sm-2 control-label"></label>
        </div>
        <!--修改身份证国徽面	start-->
        <if condition="$data['status'] neq 10 OR $data['idcard_status'] eq 2">
          <div class="form-group">
            <label for="username" class="col-sm-2 control-label">修改身份证国徽面:</label>
            <div class="col-sm-4">
              <input type="file" name="front_id_img" id="front_id_img" accept="image/png, image/jpeg, image/gif, image/jpg" onChange="getInputPicData('front')"
              />
            </div>
            <div class="col-sm-5 control-label">
              <button id="editOriginalFrontIdImgBtn" style="margin-right: 80%;">编辑图片</button>
            </div>
          </div>
        </if>
        <!--修改身份证国徽面	end-->
        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证头像面:</label>
          <div class="col-sm-5">
            <!-- <if condition="$data['back_id_img'] neq 'none'">
                        <img src="{$wu_file}{$data['back_id_img']}" width="150" height="90"/>
                    </if> -->
            <if condition="$data['back_id_img'] neq ''">
              <a href="{$wu_file}{$data.back_id_img}" target="_blank" style="display:inline;">
                <img alt="" src="{$wu_file}{$data.back_id_img}" width="100" height="80" id="originalBackIdImg" />
              </a>
              <else />
              <a href="__PUBLIC__/images/pho_back.png" target="_blank" style="display:inline;">
                <img alt="" src="__PUBLIC__/images/pho_back.png" width="100" height="80" />
              </a>
            </if>
          </div>
          <label class="col-sm-2 control-label"></label>
        </div>
        <!--修改身份证头像面	start-->
        <if condition="$data['status'] neq 10 OR $data['idcard_status'] eq 2">
          <div class="form-group">
            <label for="username" class="col-sm-2 control-label">修改身份证头像面:</label>
            <div class="col-sm-4" id="back_file">
              <input type="file" name="back_id_img" id="back_id_img" accept="image/png, image/jpeg, image/gif, image/jpg" onChange="getInputPicData('back')"
              />
            </div>
            <div class="col-sm-5 control-label">
              <button id="editOriginalBackIdImgBtn" style="margin-right: 80%;">编辑图片</button>
            </div>
          </div>
        </if>
        <!--修改身份证头像面	end-->
        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证合成图:</label>
          <div class="col-sm-5">
            <if condition="$data['id_img']">
              <if condition="!$idcard_cos">
                <img src="{$admin_file}{$data['id_img']}" width="150" height="90" />
                <else/>
                <img src="{$bucket_url}{$data['id_img']}" width="150" height="90" />
              </if>

              <else /> 无
            </if>
          </div>
          <label class="col-sm-2 control-label"></label>
        </div>

        <if condition="$data['id_img']">

          <if condition="$data['status'] neq 10">
            <div class="form-group">
              <label for="username" class="col-sm-2 control-label">修改身份证合成图:</label>
              <div class="col-sm-5">
                <input type="file" name="id_imgs" id="pic" />
              </div>
              <label class="col-sm-2 control-label"></label>
            </div>
          </if>
        </if>
        <if condition="$data['status'] neq 10">
          <div class="form-group">
            <label for="username" class="col-sm-2 control-label">是否审核通过:</label>
            <div class="col-sm-5">
              <input name="status" value="0" <if condition="$data['status'] eq 0"> checked="checked" </if> type="radio"> 未审核
        <input name="status" value="2" <if condition="$data['status'] eq 2"> checked="checked" </if> type="radio"> 未通过审核
        <input name="status" value="10" <if condition="$data['status'] eq 10"> checked="checked" </if> type="radio"> 已通过审核
        </div>
        <label class="col-sm-2 controlcontrol-label"></label>
        </div>
        </if>

        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">身份证是否失效:</label>
          <div class="col-sm-5">
            <input name="idcard_status" value="1" <if condition="$data['idcard_status'] eq 1"> checked="checked" </if> type="radio"> 否
            <input name="idcard_status" value="2" <if condition="$data['idcard_status'] eq 2"> checked="checked" </if> type="radio"> 是
          </div>
          <label class="col-sm-2 control-label"></label>
        </div>


        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">是否再次识别:</label>
          <div class="col-sm-5">
            <input name="more" value="1" checked="checked" type="radio"> 否
            <input name="more" value="2" type="radio"> 是
          </div>
          <label class="col-sm-2 control-label"></label>
        </div>

        <div class="form-group">
          <label class="col-sm-2 control-label"></label>
          <div class="col-sm-10">
            <if condition="$data['idcard_status'] neq 2">
              <button type="button" class="btn btn-success btn-add card" id="BtnSave">更新</button>
            </if>
            <button id="beClosed" class="btn btn-default" type="button" data-dismiss="modal">关闭</button>
            <input type="hidden" name="id" value="{$data['id']}" />
            <span id="messagebox" class="msgbox" style="  right:300px!important;"></span>
          </div>

        </div>

      </form>

      <!-- <script src="__PUBLIC__/js/jquery-2.1.4.min.js"></script> -->

      <script src="__PUBLIC__/js/canvas-to-blob.min.js"></script>

      <script src="__PUBLIC__/js/cropper.js"></script>
      <!-- <script src="__PUBLIC__/js/jquery-cropper.js"></script> -->




      <script type="text/javascript">
        onload = window.document.getElementById("eject").style.width = "940px";;

        function out(i) {
          var v = i.validity;
          if (true === v.valueMessing) {
            i.setCustomValidity("请填写此字段");
          } else {
            if (true === v.patternMismatch) {

              i.setCustomValidity("最多6个字母或数字，不能为中文");
            } else {
              i.setCustomValidity("");
            }
          }
        }

        function ityzl_SHOW_LOAD_LAYER() {
          return layer.msg('努力中...', {
            icon: 16,
            shade: [0.5, '#f5f5f5'],
            scrollbar: false,
            offset: '200px',
            time: 100000
          });
        }

        function ityzl_CLOSE_LOAD_LAYER(index) {
          layer.close(index);
        }

        function ityzl_SHOW_TIP_LAYER(str, url = '') {
          layer.msg('' + str + '', {
            time: 2000,
            offset: '200px'
          });
          if (url) {
            window.location = url;
          } else {
            window.location.reload();
          }
        }

        function ityzl_SHOW_TIP_LAYER_STR(str) {
          layer.msg('' + str + '', {
            time: 2000,
            offset: '200px'
          });
        }

        $('.card').click(function () {

          var status = $(':input[name="status"]:checked').val();
          var id = $(':input[name="id"]').val();
          var idcard_status = $(':input[name="idcard_status"]:checked').val();
          var pic = document.getElementById('pic');
          var card_pic = pic.files['0'];
          if (document.getElementById('back_id_img')) {
            var back_id_img_id = document.getElementById('back_id_img');
            var back_id_img = back_id_img_id.files['0'];
          }
          if (document.getElementById('front_id_img')) {
            var front_id_img_id = document.getElementById('front_id_img');
            var front_id_img = front_id_img_id.files['0'];
          }
          var true_name = $(':input[name="true_name"]').val();
          var idno = $(':input[name="idno"]').val();
          var tel = $(':input[name="tel"]').val();
          var sex = $(':input[name="sex"]').val();
          var nation = $(':input[name="nation"]').val();
          var birth = $(':input[name="birth"]').val();
          var address = $(':input[name="address"]').val();
          var authority = $(':input[name="authority"]').val();
          var valid_date_start = $(':input[name="valid_date_start"]').val();
          var valid_date_end = $(':input[name="valid_date_end"]').val();

          //if(status == 'undefined'){
          //    alert('请选择审核状态！');
          //    return;
          //}
          var formData = new FormData();
          formData.append("id", id);
          if (typeof (true_name) != 'undefined') {
            formData.append("true_name", true_name);
          }
          if (typeof (idno) != 'undefined') {
            formData.append("idno", idno);
          }
          if (typeof (tel) != 'undefined') {
            formData.append("tel", tel);
          }
          if (typeof (sex) != 'undefined') {
            formData.append("sex", sex);
          }
          if (typeof (nation) != 'undefined') {
            formData.append("nation", nation);
          }
          if (typeof (birth) != 'undefined') {
            formData.append("birth", birth);
          }
          if (typeof (address) != 'undefined') {
            formData.append("address", address);
          }

          if (typeof (authority) != 'undefined') {
            formData.append("authority", authority);
          }
          if (typeof (valid_date_end) != 'undefined') {
            formData.append("valid_date_end", valid_date_end);
          }
          if (typeof (valid_date_start) != 'undefined') {
            formData.append("valid_date_start", valid_date_start);
          }


          if (typeof (status) != 'undefined') {
            formData.append("status", status);
          }
          formData.append("idcard_status", idcard_status);
          if (card_pic != 'undefined') {
            formData.append("id_imgs", card_pic);
          }
          if (isEditOriginalImg) {
            if (hasFinishCreatePicFront) {
              console.log(frontIdImgFile);
              formData.append("front_id_img", frontIdImgFile, 'idcard-pic-front' + Math.floor(Math.random() * 10000) +
                '.png');
            }
            if (hasFinishCreatePicBack) {
              console.log(backIdImgFile);
              formData.append("back_id_img", backIdImgFile, 'idcard-pic-back' + Math.floor(Math.random() * 10000) +
                '.png');
            }
          } else {
            if (back_id_img != 'undefined') {
              formData.append("back_id_img", back_id_img);
            }
            if (front_id_img != 'undefined') {
              formData.append("front_id_img", front_id_img);
            }

          }

          var request;
          if (window.XMLHttpRequest) {
            request = new XMLHttpRequest();
          } else {
            request = new ActiveXObject('Microsoft.XMLHTTP');
          }
          var i;
          ityzl_SHOW_LOAD_LAYER();
          request.onreadystatechange = function () {
            if (request.status == 200 && request.readyState == 4) {

              if (request.responseText) {
                //成功返回
                var a = JSON.parse(request.responseText);
                var status = a.status;
                var str = a.data.strstr;
                var url = a.data.url;
                ityzl_CLOSE_LOAD_LAYER(i);
                ityzl_SHOW_TIP_LAYER(str, url);
                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                //var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                parent.layer.msg(str);
                parent.location.reload();
                parent.layer.close(index);

                //parent.layer.close(str); //再执行关闭
                ityzl_SHOW_TIP_LAYER(str, url);
                //document.getElementById("form2").reset();
              } else {
                ityzl_CLOSE_LOAD_LAYER(i);
              }
            }
          }
          request.open("post", "{:U('AdminRecipient/audit')}");
          //request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
          request.setRequestHeader("X-Requested-With", "XMLHttpRequest");
          request.send(formData);
          // 上传代码返回结果之后，将图片插入到编辑器中

          //$('form').submit();
        });

        // $('#front_id_img').change(cutOutPic('front'));

        var currentFace = '';

        // 上传图片后，编辑图片
        function getInputPicData(face = 'front') {
          console.log(face);
          let box = document.getElementById('cutPicMain');
          let img = '';
          $("#cutPicWrap").show()
          if (face == 'front') {
            currentFace = 'front';
            img = document.getElementById('front_id_img');
          } else if (face == 'back') {
            currentFace = 'back'
            img = document.getElementById('back_id_img');
          }

          let file = img.files[0];
          let url = URL.createObjectURL(file);
          if (!!document.getElementById('cutOutPic')) {
            document.getElementById('cutOutPic').src = url;
          } else {
            var image = document.createElement("img");
            image.classList.add("cut-pic-img");
            image.id = 'cutOutPic';
            image.file = file;
            image.src = url;
            box.appendChild(image);
          }
          var reader = new FileReader();
          reader.onload = (function (aImg) {
            return function (e) {
              aImg.src = e.target.result;
            };
          })(img);
          reader.readAsDataURL(file);
        }

        let isEditOriginalImg = false;

        // 编辑现有图片
        $('#editOriginalFrontIdImgBtn').click(function () {
          let targetImg = $('#originalFrontIdImg');
          if (!targetImg) {
            alert('还没有图片！');
            isEditOriginalImg = false;
          } else {
            currentFace = 'front';
            isEditOriginalImg = true;
            $("#cutPicWrap").show()
            var image = document.createElement("img");
            image.classList.add("cut-pic-img");
            image.id = 'cutOutPic';
            image.src = document.getElementById('originalFrontIdImg').src;
            document.getElementById('cutPicMain').appendChild(image);
          }
        })

        $('#editOriginalBackIdImgBtn').click(function () {
          let targetImg = $('#originalBackIdImg');
          if (!targetImg) {
            alert('还没有图片！');
            isEditOriginalImg = false;
          } else {
            isEditOriginalImg = true;
            currentFace = 'back';
            $("#cutPicWrap").show()
            var image = document.createElement("img");
            image.classList.add("cut-pic-img");
            image.id = 'cutOutPic';
            image.src = document.getElementById('originalBackIdImg').src;
            document.getElementById('cutPicMain').appendChild(image);
          }
        })

        var cropper

        //编辑图片功能事件监听
        $("#cutTargetPic").click(function () {
          console.log('cut pic');
          // let pic = $('#cutOutPic');
          // pic.cropper({
          //   viewMode: 1,
          //   strict: false,
          //   dragMode: 'crop',
          //   guides: false,
          //   autoCropArea: 0.1
          // });
          let pic = document.getElementById('cutOutPic');
          cropper = new Cropper(pic, {
            viewMode: 1,
            strict: false,
            dragMode: 'crop',
            guides: false,
            autoCropArea: 0.1
          })
        })

        var frontIdImgFile = '';
        var backIdImgFile = '';

        // 生成新图片
        let hasFinishCreatePicFront = false
        let hasFinishCreatePicBack = false

        function createNewCutPic() {
          if (currentFace == 'front') {
            hasFinishCreatePicFront = true
          } else {
            hasFinishCreatePicBack = true
          }

          console.log('create new pic');
          // var pic = $('#cutOutPic');
          // var cas = pic.cropper('getCroppedCanvas', {
          //   imageSmoothingQuality: 'high'
          // });
          var cas = cropper.getCroppedCanvas({
            imageSmoothingQuality: 'high'
          });
          // console.log(pic.cropper('getImageData'));
          // console.log(pic.cropper('getData', true));

          cas.toBlob(function (e) {
            //生成Blob的图片格式
            let url = URL.createObjectURL(e);
            if (isEditOriginalImg) {
              if (currentFace == 'front') {
                frontIdImgFile = e
              } else {
                backIdImgFile = e
              }
            }
            document.getElementById("cutOutPic").src = url;
          }, "image/png", 1);
          console.log(document.getElementById("cutOutPic"));

          // pic.cropper('destroy');
          cropper.destroy();
        }
        $('#createNewPic').click(createNewCutPic)

        $('#picRotatesToLeft').click(function () {
          console.log('pic rotates to the left');
          // let pic = $('#cutOutPic');
          // pic.cropper('rotate', -45)
          cropper.rotate(-45);
        })

        $('#picRotatesToRight').click(function () {
          console.log('pic rotates to the right');
          // let pic = $('#cutOutPic');
          // pic.cropper('rotate', 45)
          cropper.rotate(45)
        })

        $('#enlargeImage').click(function () {
          console.log('enlarge image');
          // let pic = $('#cutOutPic');
          // pic.cropper('zoom', 0.1);
          cropper.zoom(0.1);
        })

        $('#zoomImage').click(function () {
          console.log('zoom image');
          // let pic = $('#cutOutPic');
          // pic.cropper('zoom', -0.1);
          cropper.zoom(-0.1)
        })

        $("#finishEdit").click(function () {
          // if (!hasFinishCreatePicFront || !hasFinishCreatePicBack) {
          //   createNewCutPic()
          // }
          $("#cutPicWrap").hide()
          console.log(currentFace);
          if (!isEditOriginalImg) {
            if (currentFace == 'front') {
              uploadAndCheckFront();
            } else {
              uploadAndCheckBack();
            }
          } else {
            if (currentFace == 'front') {
              document.getElementById('originalFrontIdImg').src = document.getElementById('cutOutPic').src
            } else {
              document.getElementById('originalBackIdImg').src = document.getElementById('cutOutPic').src
            }
          }

          document.getElementById('cutPicMain').removeChild(document.getElementById('cutOutPic'))
        })

        function uploadAndCheckFront() {
          var id = $(':input[name="id"]').val();
          var more = $(':input[name="more"]:checked').val();

          var front_id_img_id = document.getElementById('front_id_img');
          var front_id_img = front_id_img_id.files['0'];
          var formData = new FormData();
          formData.append("id", id);
          if (typeof (more) != 'undefined') {
            formData.append("more", more);
          }
          if (front_id_img != 'undefined') {
            formData.append("front_id_img", front_id_img);
            var request;
            if (window.XMLHttpRequest) {
              request = new XMLHttpRequest();
            } else {
              request = new ActiveXObject('Microsoft.XMLHTTP');
            }
            var i;
            ityzl_SHOW_LOAD_LAYER();
            request.onreadystatechange = function () {
              if (request.status == 200 && request.readyState == 4) {
                if (request.responseText) {
                  //成功返回
                  var a = JSON.parse(request.responseText);
                  var status = a.status;
                  var emptys = a.data.emptys;
                  var str = a.data.strstr;
                  //不用再次识别，提示信息
                  if (emptys == 1) {
                    var files = $("#front_id_img").val('');
                    //files.after(files.clone().val(""));
                    //files.remove();
                    ityzl_CLOSE_LOAD_LAYER(i);
                    ityzl_SHOW_TIP_LAYER_STR(str);
                    return;
                  }
                  if (status == 1) {
                    var dis = a.data.distinguish;
                    authority_html = '<input type="text" value="' + dis.authority +
                      '" name="authority" class="form-control" />';
                    valid_date_start_html = '<input type="text" value="' + dis.valid_date_start +
                      '" name="valid_date_start" class="form-control" />';
                    valid_date_end_html = '<input type="text" value="' + dis.valid_date_end +
                      '" name="valid_date_end" class="form-control" />';

                    $('#authority').html(authority_html);
                    $('#valid_date_start').html(valid_date_start_html);
                    $('#valid_date_end').html(valid_date_end_html);
                  }

                  var url = a.data.url;
                  ityzl_CLOSE_LOAD_LAYER(i);
                  ityzl_SHOW_TIP_LAYER_STR(str);

                } else {
                  ityzl_CLOSE_LOAD_LAYER(i);
                }
              }
            }
            request.open("post", "{:U('AdminRecipient/FrontDistinguish')}");
            //request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            request.setRequestHeader("X-Requested-With", "XMLHttpRequest");
            request.send(formData);
          } else {
            alert('请上传身份证!');
          }
        }

        function uploadAndCheckBack() {
          var id = $(':input[name="id"]').val();
          var more = $(':input[name="more"]:checked').val();
          var back_id_img_id = document.getElementById('back_id_img');
          var back_id_img = back_id_img_id.files['0'];

          var formData = new FormData();
          formData.append("id", id);
          if (typeof (more) != 'undefined') {
            formData.append("more", more);
          }
          if (back_id_img != 'undefined') {
            formData.append("back_id_img", back_id_img);
            var request;
            if (window.XMLHttpRequest) {
              request = new XMLHttpRequest();
            } else {
              request = new ActiveXObject('Microsoft.XMLHTTP');
            }
            var i;
            ityzl_SHOW_LOAD_LAYER();
            request.onreadystatechange = function () {
              if (request.status == 200 && request.readyState == 4) {
                if (request.responseText) {
                  //成功返回
                  var a = JSON.parse(request.responseText);
                  var status = a.status;
                  var emptys = a.data.emptys;
                  var str = a.data.strstr;
                  //不用再次识别，提示信息
                  if (emptys == 1) {
                    var files = $("#back_id_img").val('');
                    //files.after(files.clone().val(""));
                    //files.remove();
                    ityzl_CLOSE_LOAD_LAYER(i);
                    ityzl_SHOW_TIP_LAYER_STR(str);
                    return;
                  }

                  if (status == 1) {
                    var dis = a.data.distinguish;
                    true_name_html = '<input type="text" value="' + dis.true_name +
                      '" name="true_name" class="form-control" />';
                    sex_html = '<input type="text" value="' + dis.sex + '" name="sex" class="form-control" />';
                    nation_html = '<input type="text" value="' + dis.nation +
                      '" name="nation" class="form-control" />';
                    birth_html = '<input type="text" value="' + dis.birth +
                      '" name="birth" class="form-control" />';
                    address_html = '<input type="text" value="' + dis.address +
                      '" name="address" class="form-control" />';
                    idno_html = '<input type="text" value="' + dis.idno + '" name="idno" class="form-control" />';

                    $('#true_name').html(true_name_html);
                    $('#sex').html(sex_html);
                    $('#nation').html(nation_html);
                    $('#birth').html(birth_html);
                    $('#address').html(address_html);
                    $('#idno').html(idno_html);

                  }

                  var url = a.data.url;
                  ityzl_CLOSE_LOAD_LAYER(i);
                  ityzl_SHOW_TIP_LAYER_STR(str);

                } else {
                  ityzl_CLOSE_LOAD_LAYER(i);
                }
              }
            }
            request.open("post", "{:U('AdminRecipient/BackDistinguish')}");
            //request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            request.setRequestHeader("X-Requested-With", "XMLHttpRequest");
            request.send(formData);
          } else {
            alert('请上传身份证!');
          }
        }
      </script>
    </div>
  </div>
  <div class="cut-pic-wrap" id="cutPicWrap">
    <div class="cut-pic-content">
      <div class="cut-pic-main" id="cutPicMain"></div>
      <div class="cut-pic-aside">
        <button id="cutTargetPic">裁剪图片</button>
        <button id="createNewPic">生成新图片</button>
        <button id="picRotatesToLeft">图片向左旋转</button>
        <button id="picRotatesToRight">图片向右旋转</button>
        <button id="enlargeImage">放大图像</button>
        <button id="zoomImage">缩放图像</button>
        <button id="finishEdit">完成编辑</button>
        <p style="color: red;">*图像缩小时，图像不能比截图框小，如果想要缩小图像比截图框小，请先缩小截图框</p>
      </div>
    </div>
  </div>
</body>
<script src="__PUBLIC__/js/my.js"></script>




</html>