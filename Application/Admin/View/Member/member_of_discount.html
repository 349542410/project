<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 40px;
        background-color: #f5f5f5;

      }

      .container{margin:0 auto;}
      .form-signin {
        max-width: 900px;
        margin-top:60px;
        background-color: #fff;
        border: 1px solid #e5e5e5;
        -webkit-border-radius: 5px;
           -moz-border-radius: 5px;
                border-radius: 5px;
        -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);
           -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);
                box-shadow: 0 1px 2px rgba(0,0,0,.05);
      }
    .form-signin table th{height:36px;font-size:16px;line-height:36px;background:#fff;text-align: center;border:1px #939393  solid !important;}
    .form-signin table td{height:36px;line-height:36px;font-size:14px;border:1px #939393  solid;}
    .form-signin table tr:nth-child(even){background:#CBCBCB;}
    .form-signin table td a{text-decoration:none;color:#000;}
    .form-signin table td a:hover{color:blue;}
    .form-signin .form-control{width:400px !important;}
    .
    </style>
    <link href="__PUBLIC__/css/one.css" rel="stylesheet">  
    <link href="__PUBLIC__/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="__PUBLIC__/js/jquery-1.9.1.min.js"></script>
    <script src="__PUBLIC__/bootstrap/js/bootstrap.min.js"></script>
    <script src="__PUBLIC__/layer/layer.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.bootcss.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->
    <title>会员优惠</title>
     </head>
  <body>

    <div class="container" >
      <div class="form-signin" style="background:#fff !important;margin: 40px auto;">

      <form action="" method="" class="form-inline">
          <table border="0" cellpadding="0" cellspacing="0" class="table table-hover" style="margin-bottom:0px;padding:0px">
            <thead>
              <tr>
                <th>线路名称</th>
                <th>服务费折扣(%)</th>
                <th>首重折扣(%)</th>
                <th>续重折扣(%)</th>
              </tr>
            </thead>
            <tbody>
              <volist name="list" id="vo">
                <tr id="{$vo['id']}" uid="{:I('id')}">
                  <td align="center">{$vo['name']}</td>
                  <td align="center" fd="discount_service" ondblclick="ShowElement(this)">{$vo['discount_service']}</td>
                  <td align="center" fd="discount_first" ondblclick="ShowElement(this)">{$vo['discount_first']}</td>
                  <td align="center" fd="discount_next" ondblclick="ShowElement(this)">{$vo['discount_next']}</td>
                </tr>
              </volist>
            </tbody>
            <tr>
                <td colspan="4" style="padding-left:800px;">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="javascript:window.opener.location.reload();window.close();">关闭</button>
                </td>
            </tr>
          </table>
      </form>
      </div>
    </div> 
<script type="text/javascript">
function ShowElement(element)
{
  var inval = $(element).html();                            //获得td里的html内容
  var infd = $(element).attr("fd");                        //获得td的fd属性的值
  var inid = $(element).parent().attr("id");                //获得td的父节点id属性的值
  var uid = $(element).parent().attr("uid");                //获得td的父节点id属性的值
  var oldhtml = element.innerHTML;
  var newobj = document.createElement('input');
  var par = $(element).parent().attr('class');

  if(par != 'edit'){
    $(element).parent().attr('class','edit');
    //创建新的input元素
    newobj.type = 'text';
    newobj.value = oldhtml;
    //为新增元素添加类型
    newobj.onblur = function(){
      //当触发时判断新增元素值是否为空，为空则不修改，并返回原有值 
      element.innerHTML = this.value ? this.value : oldhtml;
      var editval = element.innerHTML;
      //post表单提交
      if(editval != oldhtml){
        $.post("{:U('Member/edit_discount')}",{id:inid,uid:uid,name:infd,val:editval},function(data) {
          if(data.state == 'yes'){
            element.innerHTML = parseFloat(data.val).toFixed(2).toString();
          }else{
            element.innerHTML = parseFloat(oldhtml).toFixed(2).toString();
            alert(data.msg);

          }
        })
        
      }else{
        element.innerHTML = oldhtml;
      }
      $(element).parent().removeClass('edit');
    }
    element.innerHTML = '';
    element.appendChild(newobj);
    newobj.focus();
  }
}
</script>

  </body>
<!-- <script src="__PUBLIC__/js/my.js"></script> -->
</html>