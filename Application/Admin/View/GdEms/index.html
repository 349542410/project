<extend name="./base" />
<!-- 发货通知 -->
<block name="main">

    <div class="container">
        <div class="col-md-2">
        	<include file="Public:authNav" />
        </div>
        <div class="col-md-10">
        	<div class="rtop">
        		<ul class="list-inline">
 				 <li class="blue"><a href="javascript:void;">通知列表</a></li>

 				 <li style="float:right;font-size: 17px;">您当前所在位置：广东邮政&nbsp;/&nbsp;<a href="javascript:void(0);" class="color">发货通知</a></li>
				</ul>
				<table border="0" cellpadding="0" cellspacing="0" class="table" style="margin-bottom:0px">
						<tr>
							<td>
							<form action="{:U(CONTROLLER_NAME.'/'.ACTION_NAME)}" method="get" class="form-inline">
							<!-- 中文搜索时必须的 -->
							<input type="hidden" name="m" value="{$Think.MODULE_NAME}" />
							<input type="hidden" name="c" value="{$Think.CONTROLLER_NAME}" />
							<input type="hidden" name="a" value="{$Think.ACTION_NAME}" />
							<!-- End -->	

							<!-- 搜索栏 -->
							<script type="text/javascript" src="__PUBLIC__/js/datetime/DateTimePicker.js"></script>
							<link href="__PUBLIC__/js/datetime/DateTimePicker.css" rel="stylesheet">
							<script type="text/javascript">
								$(document).ready(function()
										{
											$("#dtBox").DateTimePicker({

												minuteInterval: 5

											});
										});
							</script>
							<div id="dtBox"></div><label>
											搜索:&nbsp;
											<input type="search" name="keyword" value="{$keyword}" class="form-control" style="width:160"/>
											</label>
											<label>
											
											<select name="searchtype" class="form-control">
												<option value="" selected>查询类别</option>
												<option value="no" <eq name="searchtype" value="no">selected</eq>>中转批号</option>
												<!-- <if condition="ACTION_NAME eq index"><option value="airno" <eq name="searchtype" value="airno">selected</eq>>航空单号</option></if> -->
											</select>
											</label>
<!-- 											<if condition="CONTROLLER_NAME eq 'Logarithm'">
												<label>&nbsp;隶属线路
													<select name="tcid" class="form-control">
													<option value="">全部</option>
													<volist name="center_list" id="vt">
														<option value="{$vt[id]}" <if condition="I('tcid') eq $vt['id']">selected</if>>{$vt['name']}</option>
													</volist>
												</select>
												</label>
											</if> -->
											<label>&nbsp;
											<if condition="(ACTION_NAME eq index) || (ACTION_NAME eq tran_track)">
												中转批号创建时间：
											<else/>
												保存航空单号时间：
											</if>
											<input type="text" class="form-control one" data-field="datetime" size="25" id="createStarttime" value="<eq name="starttime" value=""><else />{$starttime|date='Y-m-d H:i:s',###}</eq>" style="width:166" > -- <input type="text" class="form-control two" data-field="datetime" size="25" id="createEndtime" value="<eq name="endtime" value=""><else />{$endtime|date='Y-m-d H:i:s',###}</eq>" style="width:166" >
											</label>
											<input type="hidden" id="starttime" name="starttime">
											<input type="hidden" id="endtime" name="endtime">
											<label>

													<button type="submit" class="btn btn-primary " style="background-color:#3071a9;" onclick="ccc()">查询</button>
											</label>
										
							<script type="text/javascript">
							function ccc(){
								var startTime=document.getElementById("createStarttime").value;
								if(startTime != ''){
									var startback = transdate(startTime);
									document.getElementById("starttime").value=startback;
								}

								var endTime=document.getElementById("createEndtime").value;
								if(endTime != ''){
									var endback = transdate(endTime);
									document.getElementById("endtime").value=endback;
								}

							}
							function transdate(startTime){
								var date=new Date();
								date.setFullYear(startTime.substring(0,4));
								date.setMonth(startTime.substring(5,7)-1);
								date.setDate(startTime.substring(8,10));
								date.setHours(startTime.substring(11,13));
								date.setMinutes(startTime.substring(14,16));
								date.setSeconds(startTime.substring(17,19));
								return Date.parse(date)/1000;
							}
							function transdate(endTime){
								var date=new Date();
								date.setFullYear(endTime.substring(0,4));
								date.setMonth(endTime.substring(5,7)-1);
								date.setDate(endTime.substring(8,10));
								date.setHours(endTime.substring(11,13));
								date.setMinutes(endTime.substring(14,16));
								date.setSeconds(endTime.substring(17,19));
								return Date.parse(date)/1000;
							}

							</script>
							<!-- 搜索栏end -->

						</form>
						</td>
					</tr>
			</table>
				<ta<!-- 公共部分 数据展示 St2Ems,SfLogistics,Logistics-->
<style>
	dt{padding-top: 5px;text-align: center;}
	.container h3{font-size:26px;}
	.btn{width:58px;height:30px;background-color: #eee;}
	.searchbox{width:88%;margin:0 auto;}
</style>

<form action="">
<div class="container" style="">
	<volist name="list" id="vo">
		<div style="width:300px;height:275px;border:1px dotted black;float:left;margin-left:30px;margin-bottom:30px;">
			<div style="padding-top:20px;">
				<!-- 点击进行预报订单 -->
				<a href="{:U(CONTROLLER_NAME.'/predict',array('id'=>$vo['id'],'mstr'=>$vo['no'],'searchtype'=>I('searchtype')))}" target="_blank" >
					<h3 style="text-align: center;" title="中转批号"><strong>{$vo['no']}</strong></h3>
				</a>
				<dt title="中转批号创建时间">{$vo['date']}</dt>
				<dt title="线路名称">{$vo['name']}</dt>
				<dt title="航空单号"><a href="{:U('Logarithm/info',array('id'=>$vo['id']))}" data-toggle="modal" data-target="#myModal">{$vo['airno']}</a></dt>
				<dt title="保存航空号时间">{$vo['airdatetime']}</dt>
				<dt style="padding-left:200px;">
<!-- 					<span class="twn{$vo.id}">
					<if condition="$vo['twn'] eq 0">
						<span style="font-size: 15px;">已完成</span>
					<else />
						<a target="_blank" href="{:U('PostManagement/showList',array('mstr'=>$vo['no'],'stype'=>'miss','id'=>$vo['id']))}">{$vo['twn']}</a>
					</if>
					</span> /  -->
					数量：<span class="all{$vo.id}"><a target="_blank" href="{:U('PostManagement/showList',array('mstr'=>$vo['no'],'stype'=>'normal','id'=>$vo['id']))}">{$vo['all']}</a></span>
				</dt>
				<!-- 大于10的才显示刷新按钮 -->
				<if condition="$vo.status gt 10">
					<dt>
						<!-- <button type="button" class="btn btn-default{$vo['id']}" onclick="reflash('{$vo.id}');">刷新</button> -->
						<span class="loading{$vo['id']}"></span>
					</dt>
				</if>
				
			</div>
		</div>	
	</volist>
</div>
<script>
	function reflash(id){
		$.ajax({
			url:'{:U('Logarithm/reflash')}',
			type:'post',
			dataType:'json',
			data:{
				'id':id,
			},
			beforeSend:function(){
				$(".btn.btn-default"+id).html('<img style="width:18px;height:18px;" src="__PUBLIC__/images/msg_loading_d.gif"/>');
				// $(".loading"+id).html('&nbsp;<img style="width:20px;height:20px;" src="__PUBLIC__/images/msg_loading_d.gif"/>');
			},
			success:function (result){
				// $(".loading"+id).html('&nbsp;<img style="width:20px;height:20px;" src="__PUBLIC__/images/success.png"/>');
				$(".btn.btn-default"+id).attr('disabled','disabled');
				if(result.twn != '0'){
					$(".twn"+id).html(result.twn);	//IL=20数量
				}else{
					$(".twn"+id).html('<span style="font-size: 15px;">已完成</span>');	//IL=20数量
				}
				$(".all"+id).html(result.total);	//总数
				var t = result.timeout;	//倒数时间
				showTime(id,t,result.twn);	//倒计时
			}
		})
	}

function showTime(id,t,twn){
    $(".btn.btn-default"+id).html(t);
    t--;
    //当=0的时候，终止自动刷新
    if(twn == 0){
        // $(".btn.btn-default"+id).removeAttr('disabled');
        $(".btn.btn-default"+id).html("刷新");
        return false;
    }
    if(t < 0){
    	$(".btn.btn-default"+id).html("刷新");
    	$(".btn.btn-default"+id).click();	//模拟点击，以便继续自动刷新
    	return false;
    }
    //每秒执行一次,showTime()
    setTimeout("showTime("+id+","+t+")",1000);
}

// 20160113 另一个刷新类型
// function showTime(id,t){
//     $(".btn.btn-default"+id).html(t);
//     t--;
//     if(t < 0){
//         $(".btn.btn-default"+id).removeAttr('disabled');
//         $(".btn.btn-default"+id).html("刷新");
//         return false;
//     }
//     //每秒执行一次,showTime()
//     setTimeout("showTime("+id+","+t+")",1000);
// }
</script>

</form>

				<div id="pages" class="page">{$page}</div>
        	</div>
        </div>
		</div>		
<div class="foot"></div>

</block>


</body>
</html>