<extend name="./base" />

<block name="main">

    <div class="container">
        <div class="col-md-2">
			<include file="Public:authNav" />
        </div>
        <div class="col-md-10">
        	<div class="rtop">
        		<ul class="list-inline">
 				 <if condition="ACTION_NAME eq 'index_authNav_role'">
 				 		<li class="blue"><a href="{:U('AdminAuth/roleAdd')}" data-toggle="modal" data-target="#myModal" >角色添加</a></li>
 				 	<else />
 				 		<li class="blue"><a href="{:U('AdminAuth/role')}">角色列表</a></li>
 				 		
 				 	</if>
 				 <li style="float:right">您当前所在位置：权限管理&nbsp;/&nbsp;<a href="javascript:void(0);" class="color">角色列表</a></li>
				</ul>

				
					<table border="0" cellpadding="0" cellspacing="0" class="table table-hover" style="border-bottom:none !important">
						<thead>
							<tr>
								<th align="center">编号</th>
								<th align="center">角色名称</th>
								<th align="center">角色描述</th>
								<th align="center">状态</th>
								<th align="center">操作</th>
							</tr>
						</thead>	
						<volist name='data' id="vo" mod="2">
						<tr  <eq name="mod" value="1"> style="background-color:#ddd;"</eq>>
							<td align="center">{$i+$num}</td>
							<td align="center">{$vo['title']}</td>
							<td align="center">{$vo['describe']}</td>
							<td align="center">
							<!-- 
								<if condition="$vo['status'] eq 1"><span class="label label-success"><i class="glyphicon glyphicon-ok"></i></span>
								<else />
									<span class="label label-danger">							
									<i class="glyphicon glyphicon-remove"></i></span>
								</if> -->
								<img src="__PUBLIC__/images/<if condition="$vo['status'] eq 1">pass.png<else />nopass.png</if>"  width="20" height="20" />
							</td>
							<td align="center" class="td3">
								
									<a href="{:U('AdminAuth/permission',array('id' => $vo['id'], 'name' => $vo['title']))}" class="" >角色设置</a>&nbsp;|
									<a href="{:U('AdminAuth/member',array('id' => $vo['id']))}" class="">成员管理</a>&nbsp;|
									<a href="{:U('AdminAuth/roleEdit',array('id' => $vo['id']))}" class="" data-toggle="modal" data-target="#myModal">修改</a>&nbsp;|
									<!--  <a href="{:U('/Auth/roleDel',array('id'=>$vo['id']))}" class="btn btn-danger">{:L('Delete')}</a>-->
									<a onclick="role(this)" id="{$vo['id']}" name="{$vo['title']}" url_a="{:U('AdminAuth/roleDel',array('id'=>$vo['id']))}" href="#" class="">删除</a>
								
							</td>
						</tr>

						</volist>
						<tr>
							<td colspan='7' class="page" id="pages">{$page}</td>
						</tr>
					</table>
				

        	</div>
        </div>
		</div>		
<div class="foot"></div>
<script type="text/javascript">
function ityzl_SHOW_LOAD_LAYER(){  
    return layer.msg('努力中...', {icon: 16,shade: [0.5, '#f5f5f5'],scrollbar: false,offset: '200px', time:100000}) ;  
}  
function ityzl_CLOSE_LOAD_LAYER(index){  
    layer.close(index);  
}  
function ityzl_SHOW_TIP_LAYER(str, url = ''){  
    layer.msg(''+str+'',{time: 2000,offset: '200px'}); 
    if(url){
    	window.location = url;
    }else{
    	window.location.reload(); 
    }
}
function fromdata(obj){
	var status = $(':input[name="status"]:checked').val();
	var describe = $(':input[name="describe"]').val();
	var groupName = $(':input[name="groupName"]').val();
	var id = $(':input[name="id"]').val();

	var formData = new FormData();
	formData.append("id", id);
	formData.append("status", status);
	formData.append("describe", describe);
	formData.append("groupName", groupName);
	
	var request;
	if (window.XMLHttpRequest) {
		request = new XMLHttpRequest();
	} else {
	    request = new ActiveXObject('Microsoft.XMLHTTP');
	}
	var i;
	ityzl_SHOW_LOAD_LAYER();
	request.onreadystatechange = function(){
		if(request.status == 200 && request.readyState == 4){
			if(request.responseText){
				//成功返回
				var a = JSON.parse( request.responseText );
				var status = a.status;
				var str = a.data.strstr;
				var url = a.data.url;
				ityzl_CLOSE_LOAD_LAYER(i); 
                ityzl_SHOW_TIP_LAYER(str, url);
                //document.getElementById("form1").reset();	
				
			}else{
				ityzl_CLOSE_LOAD_LAYER(i);
			}
		}
	}
	request.open("post", "{:U('AdminAuth/roleAddHandle')}");
	//request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	request.setRequestHeader("X-Requested-With","XMLHttpRequest");
	request.send(formData);								
	// 上传代码返回结果之后，将图片插入到编辑器中
	
	
}




	function role(obj){
		var id = $(obj).attr('id');
		var url_a = $(obj).attr('url_a');;
		//var url = url_a + '/id/' + id;
		var url = url_a;
		var del_sn = $(obj).attr('name');
		if(confirm('是否删除角色名为：'+ del_sn + ' 的信息！')){
			//window.location.href=url;
			
			var formData = new FormData();
			formData.append("id", id);
			var request;
			if (window.XMLHttpRequest) {
				request = new XMLHttpRequest();
			} else {
			    request = new ActiveXObject('Microsoft.XMLHTTP');
			}
			var i;
			ityzl_SHOW_LOAD_LAYER();
			request.onreadystatechange = function(){
				if(request.status == 200 && request.readyState == 4){
					if(request.responseText){
						//成功返回
						var a = JSON.parse( request.responseText );
						var status = a.status;
						var str = a.data.strstr;
						var url = a.data.url;
						ityzl_CLOSE_LOAD_LAYER(i); 
		                ityzl_SHOW_TIP_LAYER(str, url);
		                document.getElementById("form1").reset();	
						
					}else{
						ityzl_CLOSE_LOAD_LAYER(i);
					}
				}
			}
			request.open("post", url);
			//request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			request.setRequestHeader("X-Requested-With","XMLHttpRequest");
			request.send(formData);	
		} 
	}

</script>
</block>


</body>
</html>