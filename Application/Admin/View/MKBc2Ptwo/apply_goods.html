<extend name="./base" />

<block name="main">

    <div class="container">
        <div class="col-md-2">
        	<include file="Public:authNav" />
        </div>
        <div class="col-md-10">
        	<div class="rtop">
        		<ul class="list-inline">
 				 <li class="blue"><a href="javascript:void;">商品报备列表</a></li>

 				 <li style="float:right;font-size:17px;">您当前所在位置：美快BC优选2&nbsp;/&nbsp;<a href="javascript:void(0);" class="color">商品报备</a></li>
				</ul>
				<table border="0" cellpadding="0" cellspacing="0" class="table" style="margin-bottom:0px">
						<tr>
							<td>
							<form action="{:U(CONTROLLER_NAME.'/'.ACTION_NAME)}" method="get" class="form-inline">
							<!-- 中文搜索时必须的 -->
							<input type="hidden" name="m" value="{$Think.MODULE_NAME}" />
							<input type="hidden" name="c" value="{$Think.CONTROLLER_NAME}" />
							<input type="hidden" name="a" value="{$Think.ACTION_NAME}" />
							<!-- End -->	

							<label>筛选：<input type="search" name="keyword" placeholder="" value="{$keyword}" class="form-control" style="width:200" />
							</label>
							<label>
								<select name="searchtype" class="form-control" >
									<option value="" selected>搜索类型</option>
									<!-- <option value="CID" <eq name="searchtype" value="CID">selected</eq>>公司名称</option> -->
									<option value="EntGoodsNo" <eq name="searchtype" value="EntGoodsNo">selected</eq>>商品 ID</option>
									<option value="GoodsName" <eq name="searchtype" value="GoodsName">selected</eq>>商品名称</option>
								</select>
							</label>
							<label>
								<select name="CID" class="form-control">
									<option value="">公司名称</option>
									<volist name="union" id="yo">
										<option value="{$yo['id']}" <if condition="$CID eq $yo['id']">selected</if>>{$yo['unname']}</option>
									</volist>
								</select>
							</label>
							<label>
								<select name="status" class="form-control">
									<option value="">海关报备状态</option>
									<option value="0" <if condition="$status eq '0'">selected</if>>未通过</option>
									<option value="1" <eq name="status" value="1">selected</eq>>通过</option>
								</select>
							</label>
							<label>
								<select name="state" class="form-control">
									<option value="">EMS报备状态</option>
									<option value="0" <if condition="$state eq '0'">selected</if>>未通过</option>
									<option value="1" <eq name="state" value="1">selected</eq>>通过</option>
								</select>
							</label>
<!-- 							<input type="checkbox" name="problem" id="problem" <if condition="I('problem') eq 'on'">checked</if>><label for="problem" style="margin-bottom: 0px;">&nbsp;只显示问题件&nbsp;&nbsp;</label> -->
							<label>
								&nbsp;&nbsp;行数：
								<select name="ePage" id="" class="form-control" >
									<option value="10" <eq name="ePage" value="10">selected</eq>>10</option>
									<option value="20" <eq name="ePage" value="20">selected</eq>>20</option>
									<option value="30" <eq name="ePage" value="30">selected</eq>>30</option>
									<option value="50" <eq name="ePage" value="50">selected</eq>>50</option>
									<option value="100" <eq name="ePage" value="100">selected</eq>>100</option>
								</select>
							</label>
							<label>

									<button type="submit" class="btn btn-primary btn-lg" onclick="ccc()" >查询</button>
							</label>
							</form>
							</td>
						</tr>
			</table>
			<button type="button" style="display: inline-block; float:right;margin-left:10px !important;" class="btn btn-default" id="logis_more_EMS" onclick="getLogit('EMS');" style="padding:2px 12px;">批量操作EMS商品报备</button>
			<button type="button" style="display: inline-block; float:right;" class="btn btn-default" id="logis_more_HG" onclick="getLogit('HG');" style="padding:2px 12px;">批量操作海关商品报备</button>
				<table border="0" cellpadding="0" cellspacing="0" class="table table-hover" style="border-bottom:none !important">
					<thead>
						<tr>
							<th><input type="checkbox" name="select" id="selectAll"><label for="selectAll" style="margin-bottom: 0px;">&nbsp;全选</label></th>
							<th>序号</th>
							<th>商品 ID</th>
							<th>商品名称</th>
							<th>公司名称</th>
							<th>单价(￥)</th>
							<th>净重({:C('SHOW_WEIGHT_UNIT')})</th>
							<th>毛重({:C('SHOW_WEIGHT_UNIT')})</th>
							<th>海关报备时间</th>
							<th>海关报备状态</th>
							<th>EMS报备状态</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody style="font-size:15px;">
						<volist name="list" id="vo" mod="2">
						<tr id="tr_{$vo.id}" <eq name="mod" value="1"> style="background-color:#ddd;"</eq>>
							<td align="center" style="vertical-align:middle;">
								<input type="checkbox" name="tno" value="{$vo['id']}" id="tno_{$vo['id']}">
							</td>
							<td class="td1">
								<!-- {$vo.id} -->
								{$key+1}
							</td>
							<td class="td1">
								{$vo.EntGoodsNo}
							</td>
							<td class="td1" title="{$vo['GoodsName']}">
								<if condition="strlen($vo['GoodsName']) gt 20">
									<!-- <php>echo substr_replace($vo['GoodsName'],'...',20)</php> -->
									<php>echo change_code($vo['GoodsName'],20,'...')</php>
								<else />
									{$vo['GoodsName']}
								</if>
							</td>
							<td class="td1">
								{$vo.unname}
							</td>
							<td class="td1">
								{$vo.RegPrice}
							</td>
							<td class="td1">
								{$vo.NetWt}
							</td>
							<td class="td1">
								{$vo.GrossWt}
							</td>

							<td class="td1">
								{$vo.SendTime}
							</td>
							<td class="td1">
								<if condition="$vo['apply_status'] eq '1'">
									<font color="green">通过</font>
								<elseif condition="$vo['apply_status'] eq '0'"/>
									<font color="red">未通过</font>
								</if>
							</td>
							<td class="td1">
								<if condition="$vo['ems_status'] eq '1'">
									<font color="green">通过</font>
								<elseif condition="$vo['ems_status'] eq '0'"/>
									<font color="red">未通过</font>
								</if>
							</td>
							<td align="center" class="td3">
								<a href="{:U(CONTROLLER_NAME.'/viewGood',array('id'=>$vo['id']))}" data-toggle="modal" data-target="#myModal">查看</a>
								<if condition="$vo['apply_status'] eq '0'">
								 | 
										<a href="{:U(CONTROLLER_NAME.'/editGood',array('id'=>$vo['id']))}" data-toggle="modal" data-target="#myModal">修改</a>
								<if condition="$vo['apply_status'] eq '0'">
								 | 
									<a href="javascript:void(0)" onclick="applyAgain('{$vo.id}','HG')" class="HG{$vo['id']}" data-target="#myModal">海关报备</a>
								</if>
									<!-- <a href="{:U('GdEms/applyHG',array('id'=>$vo['id']))}" class="logis{$vo['id']}" data-target="#myModal">测试海关报备</a> -->
								</if>
								<if condition="$vo['ems_status'] eq '0'">
								 | 
									<a href="javascript:void(0)" onclick="applyAgain('{$vo.id}','EMS')" class="EMS{$vo['id']}" data-target="#myModal">EMS报备</a>
								</if>
								<!-- <a href="{:U('GdEms/applyEMS',array('id'=>$vo['id']))}" class="logis{$vo['id']}" data-target="#myModal">EMS报备</a> -->
							</td>
						</tr>
						</volist>
					</tbody>
<!-- 						<tr>
							<td colspan="8" style="background:#f6f6f6"><input type="submit" value="删除"/></td>
						</tr> -->
				</table>

				<div id="pages" class="page">{$page}</div>
        	</div>
        </div>
		</div>
<script type="text/javascript">
// 20161018 Jie 批量操作商品申报(多个运单号)
function getLogit(type){
  var chk_value  = []; //获取选中的复选框选中的值
  var url;
  var txt = $("#logis_more_"+type).html();
  if(type == 'HG'){
  	url = "{:U('GdEms/applyHG')}";
  }else{
  	url = "{:U('GdEms/applyEMS')}";
  }
// alert(url);exit;
  $('input[name="tno"]:checked').each(function(){
    chk_value.push($(this).val());  //合拼选中的面单，组成字符串 
  });

  // 检验是否至少勾选一个
  if(chk_value == ''){
    alert('请选择至少一个商品进行操作！');return false;
  }else{
    chk_value = ''+chk_value+'';
  }
  // alert(chk_value);
  $.ajax({
    url: url,
    type:'post',
    dataType:'json',
    data:{
    	'id' :chk_value,
    },
    success:function (data){

        alert(data.msg);
      
    },
    error:function(){
    	alert('请求失败或系统超时，请重试');
    },
    complete:function(){
		$("#logis_more_"+type).removeAttr('disabled');
		$("#logis_more_"+type).html(txt);
		window.location=window.location;       //刷新页面
    },
    beforeSend:function(){
      $("#logis_more_"+type).attr('disabled','disabled');
      $("#logis_more_"+type).html('<img style="width:18px;height:18px;" src="__PUBLIC__/images/msg_loading_d.gif"/>请稍候...');
    }
  })
}

// 20161028 Jie 商品申报(单个)
function applyAgain(id,type){
  if(type == 'HG'){
  	url = "{:U('GdEms/applyHG')}";
  }else{
  	url = "{:U('GdEms/applyEMS')}";
  }

  $.ajax({
    url: url,
    type:'post',
    dataType:'json',
    data:{
      'id':id,
    },
    success:function (data){
      alert(data.msg);
    },
    error:function(){
      alert('请求失败或系统超时，请重试');
    },
    complete:function(){
      // $("."+type+id).html('申报');
      window.location=window.location;       //刷新页面
    },
    beforeSend:function(){
      $("."+type+id).html('<img style="width:18px;height:18px;" src="__PUBLIC__/images/msg_loading_d.gif"/>');
    }
  })
}

// 全选/反选
$("#selectAll").click(
  function(){
    if(this.checked){
      $("input[name='tno']").each(function(){this.checked=true;});
    }else{
      $("input[name='tno']").each(function(){this.checked=false;});
    }
  }
);
</script>
<div class="foot"></div>

</block>


</body>
</html>