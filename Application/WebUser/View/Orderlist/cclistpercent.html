<!-- CC线路-百分比 -->
<script type="text/javascript">
    $(function(){
        // 获取线路ID
        var t_line = $("input[name='TransferLine']:checked").val();
        // 声明全局变量 装载element-ui所需的数据格式
        window.globa_selec_gory = {options:[]};
        // 数据组装
        if(category_list[t_line] != undefined) {
            $.each(category_list[t_line], function (k, v) {
                globa_selec_gory.options.push(v);
            });
        }
        // 获取英文品牌数据
        window.brand_list = {$brand_list};

        // 获取货品名称（中文）
        window.user_goods_name = {$user_goods_name};

        // 单位所需变量
        window.sunit = [];
    });
</script>
<style>
    .goods_width{
        width: 285px;
    }
    .cnlist_width{
        width: 193px;
    }
    .enlist_width{
        width: 193px;
    }
    .pirce_width{
        width: 100px;
    }
    .sunit_width{
        width: 150px;
    }
    .amount_width{
        width: 71px;
    }
    .isall_width{
        width: 67px;
    }
    .tax_width{
        width: 80px;
    }
    .reamk_width{
        width: 156px;
    }
</style>
<div class="ordhead" style="width: 1230px;"><h3>{:L('l_Package_Information')}</h3></div>
<if condition="$html_name neq 'import'">
    <div class="btn_box" style="width: 1230px;position: relative;">
        <!-- <button class="formright" onclick="return false;">模板下载</button> -->
        <a class="formright fir_a" id="download_btn" style="cursor: pointer;">{:L('l_Template_File_Download')}</a>
        <!-- <button class="formright fir_b" onclick="return false;">导入</button> -->
        <form id="fileform" action="" method="post" enctype="multipart/form-data">
            <input type="file" name="file_two" id="uploadfile" data-min-file-count="1"/>
        </form>
        <!-- <label class="fir_b">导入</label> -->
        <div style="clear: both;"></div>
    </div>
</if>
<div class="ordbody oblast" style="width: 1265px;position: relative;">
    <table class="table_now"
    <if condition="$html_name eq 'index'">
        style="margin:10px auto;height:110px;width: 1311px;margin-left: -42px;position: relative;"
        <elseif condition="$html_name eq 'import'"/>
        style="margin:10px auto;height:110px;width: 1311px;margin-left: -42px;position: relative;"
        <else/>
        style="margin:10px auto;height:110px;width: 1343px;margin-left: -42px;position: relative;"
    </if> id="table">
    <input type="hidden" id="num" value="{$count-1}" autocomplete="off" >
    <input type="hidden" id="max_row" value="{$count-1}" autocomplete="off" >
    <tr>
        <td style="font-weight: bold;" class="copy_r"></td>
        <!-- 货品列表 -->
        <td class="goods_width" style="font-weight: bold;">{:L('l_Item_List')}</td>
        <!-- 货品名称（中文） -->
        <td class="cnlist_width" style="font-weight: bold;">
            {:L('l_Product_Name')}<br>
            <span style="font-size: 10px;color: #f00">*{:L('l_input_order_content')}</span>
        </td>
        <!-- 英文品牌 -->
        <td class="enlist_width" style="font-weight: bold;">{:L('BrandName')}</td>
        <!-- 单价 -->
        <td class="pirce_width" style="font-weight: bold;">{:L('l_Unit_Price')}</td>
        <!-- 规格/容量 -->
        <td class="sunit_width" style="font-weight: bold;">{:L('l_speci')}</td>
        <!-- 数量 -->
        <td class="amount_width" style="font-weight: bold;">{:L('Amount')}</td>
        <!--是否套装-->
        <td class="isall_width" style="font-weight: bold;">{:L('l_is_allunit')}</td>
        <!-- 单位 -->
        <!-- <td width="10%" style="font-weight: bold;">{:L('Unit')}</td> -->
        <!-- 产地 -->
        <!-- <td width="10%" style="font-weight: bold;">{:L('CountryOfOrigin')}</td> -->
        <!-- 关务费 -->
        <td class="chuijin tax_width" style="font-weight: bold;">{:L('l_Duty_Fee')}</td>
        <!-- 备注 -->
        <td class="reamk_width" style="font-weight: bold;">{:L('Remarks')}</td>
        <td class="imgnull" style="border:none"><img src="__MEMBER__/images/null.png"  /></td>
    </tr>
    <!--                         示例 stat
                            <tr class="stta">
                                <td <if condition="(L('lng') eq 'en-us')"> class="infopus copy_r" style="top:65px;left:-30px;"<else /> class="infopcn copy_r" style="top:65px;left:15px;"</if>>{:L('l_exm')}：</td>
                                品牌
                                <td width="10%;"><input type="text" value="Abbott" disabled class="clchang"></td>
                                货品名称
                                <td width="10%;"><input type="text" value="1段婴儿奶粉" disabled class="clchang"></td>
                                规格/容量
                                <td width="10%;"><input type="text" value="0.96kg" disabled class="clchang" maxlength="10"></td>
                                海关所属类别
                                <td width="40%;">
                                    <select style="width:95px;" class="catone colored">
                                        <option value="">食品饮料</option>
                                    </select>
                                    <select style="width:95px;" class="cattwo colored">
                                        <option value="">食品</option>
                                    </select>
                                </td>
                                税金
                                <td width="10%;" class="chuijin"><label>0.00</label></td>
                                数量
                                <td width="10%;"><input type="number" min="1" value="1" disabled class="clzd" maxlength="9"></td>
                                单位
                                <td width="10%;"><input type="text" value="罐" disabled class="clzd" maxlength="9"></td>
                                产地
                                <td width="10%;"><input type="text" value="美国" disabled class="clzhong" maxlength="9"></td>
                                单价
                                <td width="10%;"><input type="text" class="clzhong" value="24" disabled maxlength="9"></td>
                                备注
                                <td width="10%;" ><input type="text" value="" class="clchang"></td>
                                删除行
                                <td style="border:none;" class="nows nows{$j}"></td>
                            </tr>
                            <tr class="stta">
                                <td <if condition="(L('lng') eq 'en-us')"> class="infopus copy_r"<else /> class="infopcn copy_r"</if>></td>
                                品牌
                                <td width="10%;"><input type="text" value="COLUMBIA" disabled class="clchang"></td>
                                货品名称
                                <td width="10%;"><input type="text" value="男童短裤" disabled class="clchang"></td>
                                货品类别
                                <td width="10%;"><input type="text" value="S" disabled class="clchang" maxlength="5"></td>
                                海关所属类别
                                <td width="40%;">
                                    <select style="width:95px;" class="catone colored">
                                        <option value="">箱包&衣服配饰&鞋靴</option>
                                    </select>
                                    <select style="width:95px;" class="cattwo colored">
                                        <option value="">衣服</option>
                                    </select>
                                </td>
                                税金
                                <td width="10%;" class="chuijin"><label>0.00</label></td>
                                数量
                                <td width="10%;"><input type="number" min="1" value="1" disabled class="clzd" maxlength="9"></td>
                                单位
                                <td width="10%;"><input type="text" value="件" disabled class="clzd" maxlength="9"></td>
                                产地
                                <td width="10%;" style="display: none"><input type="text" value="美国" disabled class="clzhong" maxlength="9"></td>
                                单价
                                <td width="10%;"><input type="text" class="clzhong" value="13" disabled maxlength="9"></td>
                                备注
                                <td width="10%;" ><input type="text" value="" class="clchang"></td>
                                删除行
                                <td style="border:none;" class="nows nows{$j}"></td>
                            </tr> -->
    <!-- 示例 end -->
    <!-- 配置控制行数 gan -->
    <for start="0" end="$count" name="j">
        <tr class="stta" cid="{$j}">
            <!-- 复制行<a onclick="copy_row(this)" href="javascript:void(0)">增加</a> -->
            <td class="copy_r "><if condition="$j eq 0"><else/><a onclick="del_row(this)" href="javascript:void(0)">{:L('l_del')}</a></if></td>
            <!-- <td class="copy_r"></td> -->
            <input class="ttc" type="hidden" name="oid_{$j}" value="{$pro_list[$j][oid]}"/>
            <!-- 货品列表 -->
            <td class="seleopt goods_width" style="position: relative;">
                <!--                                 <select style="width:95px;" class="catone" name="category_one_{$j}" onchange="selecchang(this)">
                                                    <option value="">{:L('ClassOne')}</option>
                                                    <volist name="cat_list" id="vvo">
                                                        <php>
                                                        if($vvo['id'] == $pro_list[$j]['category_one']){
                                                            $catoid = $vvo['id'];
                                                        }
                                                        </php>
                                                        <option value="{$vvo['id']}" <if condition="$vvo['id'] eq $pro_list[$j]['category_one']">selected</if>>{$vvo['cat_name']}</option>
                                                    </volist>
                                                </select>
                                                <select style="width:95px;" class="cattwo" name="category_two_{$j}" onchange="selectc(this)">
                                                    <option value="">{:L('ClassTwo')}</option>
                                                    <volist name="cat_list[$catoid]['child']" id="vvto">
                                                        <php>
                                                        if($vvto['id'] == $pro_list[$j]['category_two']){
                                                            $price = $vvto['price'];
                                                            $num = $pro_list[$j]['number'];
                                                            $product_id = $pro_list[$j]['product_id'];
                                                        }
                                                        </php>
                                                        <option value="{$vvto['id']}" price="{$vvto['price']}" <if condition="$vvto['id'] eq $pro_list[$j]['category_two']">selected</if>  pic="{$product_id}">{$vvto['cat_name']}</option>
                                                    </volist>
                                                </select> -->
                <div id="app_category_{$j}">
                    <div class="block" id="selec_box">
                        <el-cascader v-model="selectedOptions" placeholder="{:L('l_Category1_Category2')}" :options="options" filterable @change="goryChange"></el-cascader>
                        <input type="hidden" name="category_one_{$j}" id="cate_one" value="{$pro_list[$j][category_one]}">
                        <input type="hidden" name="category_two_{$j}" id="cate_two" value="{$pro_list[$j][category_two]}">
                        <input type="hidden" id="cate_pirce" value="">
                    </div>
                </div>
            </td>
            <!-- 货品名称(中文) -->
            <td class="detail cnlist_width">
                <!--                                 <div id="app_detail_{$j}">
                                                <el-row class="demo-autocomplete">
                                                      <el-col :span="50">
                                                        <el-autocomplete class="inline-input" clearable v-model="state1" :fetch-suggestions="querySearch" placeholder="请输入内容" name="detail_{$j}" @select="handleSelect"></el-autocomplete>
                                                      </el-col>
                                                    </el-row>
                                                </div> -->
                <div id="app_detail_{$j}">
                    <el-row class="demo-autocomplete">
                        <el-col :span="20">
                            <el-autocomplete class="inline-input" clearable v-model="state1" :fetch-suggestions="querySearch" placeholder="{:L('l_input_content')}" name="detail_{$j}" @select="handleSelect"></el-autocomplete>
                        </el-col>
                    </el-row>
                </div>
                <!--                                 <input type="text" value="{$pro_list[$j]['detail']}" name="detail_{$j}" style="width: 113px;" class="form-control" <if condition="$j eq 0">data-validation-engine="validate[required]"</if>> -->

            </td>
            <!-- 英文品牌 -->
            <td class="brand enlist_width">
                <!--                                 <div id="app_brand_{$j}">
                                                    <template>
                                                        <el-select v-model="value" clearable filterable placeholder="请选择" @change="goryChange">
                                                        <el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value">
                                                        </el-option>
                                                        </el-select>
                                                    </template>
                                                    <input type="hidden" value="{$pro_list[$j][brand]}" name="brand_{$j}" class="form-control" id="brand_val">
                                                </div> -->
                <div id="app_brand_{$j}">
                    <el-row class="demo-autocomplete">
                        <el-col :span="20">
                            <el-autocomplete class="inline-input" clearable v-model="state1" :fetch-suggestions="querySearch" placeholder="{:L('l_input_content')}" name="brand_{$j}" @select="handleSelect"></el-autocomplete>
                        </el-col>
                    </el-row>
                </div>
                <!--                                 <div id="brand_list_{$j}">
                                                    <div class="block" id="barndsel_box">
                                                        <el-cascader v-model="selectedOptions" placeholder="请选择" :options="options" filterable @change="goryChange"></el-cascader>
                                                        <input type="text" value="{$pro_list[$j]['brand']}" name="brand_{$j}" style="width: 113px;" class="form-control" <if condition="$j eq 0">data-validation-engine="validate[required]"</if>>
                                                    </div>
                                                </div> -->
            </td>
            <!-- 单价 -->
            <td class="price pirce_width"><input type="text" name="price_{$j}" class="form-control" style="width: 83px;" value="{$pro_list[$j]['price']}" maxlength="9" onblur="priper(this)" onkeyup="pirce_is_num_val(this)"></td>
            <!-- 规格/容量 -->
            <td class="catname sunit_width">
                <input type="text" name="catname_{$j}" value="{$pro_list[$j]['catname']}" style="width: 60px;display: inline-block;margin-top: -32px;" class="form-control">
                <!--<select name="spec_unit_{$j}" class="form-control spec_unit{$j}" id="spec_unit">-->
                    <!--<option value="">{:L('l_Unit')}</option>-->
                <!--</select>-->
                <div id="app_sunit_{$j}" style="display: inline-block;width: 106px;">
                    <el-row class="demo-autocomplete">
                        <el-col :span="50">
                            <el-autocomplete class="inline-input" clearable v-model="state1" :fetch-suggestions="querySearch" placeholder="{:L('l_plan_unit')}" name="spec_unit_{$j}" @select=""></el-autocomplete>
                        </el-col>
                    </el-row>
                </div>
            </td>
            <!--<select name="num_unit_{$j}" class="form-control num_unit{$j}" id="num_unit">-->
            <!--<option value="">{:L('l_Unit')}</option>-->
            <!--</select>-->
            </td>
            <!-- 数量 -->
            <td class="amount amount_width">
                <input type="text" name="amount_{$j}" value="{$pro_list[$j]['number']}" class="form-control" style="width: 60px;" maxlength="9" onblur="amper(this)" onkeyup="is_num_val(this)">
            <!--是否套装-->
            <td class="isall_width">
                <div class="checkbox">
                    <label><input type="checkbox" name="is_suit_{$j}" value="1" <if condition="($pro_list[$j]['is_suit'] eq 1)"> checked</if> style="margin:0;vertical-align: middle;margin-top: -2px;cursor: pointer;" /></label>
                </div>
            </td>
            <!-- 单位 -->
            <!-- <td width="10%;"><input type="text" name="unit_{$j}" value="{$pro_list[$j]['unit']}" class="clzd" maxlength="9" <if condition="$j eq 0">data-validation-engine="validate[required]"</if>></td> -->
            <!-- 产地 -->
            <td style="display: none"><input type="text" name="source_area_{$j}" value="{$pro_list[$j]['source_area']|default='美国'}" class="clzhong" maxlength="9"></td>
            <!-- 货币 -->
            <input type="hidden" name="coin_{$j}" value="USD">
            <!-- 关务税 -->
            <td class="chuijin tax_width"><label>0.00</label></td>
            <!-- 备注 -->
            <td class="reamk_width"><input type="text" value="{$pro_list[$j]['remark']}" name="remark_{$j}" style="width: 145px;" placeholder="{:L('l_other_information')}" class="form-control"></td>
            <!-- 删除行 -->
            <!--                           <td style="border:none;" class="nows nows{$j}"><a href="javascript:void(0);" title="{:L('Delete')}"><img width="22" height="22" src="__MEMBER__/images/clean.png" /></a></td> -->
        </tr>
        <script type="text/javascript">
            // 为快件信息设置默认值
            // 添加页面设置为空值
            // 修改页面设置为默认值
            $(function(){
                if("{$html_name}" == 'index'){
                    unit_element_input("{$j}");
                    // 添加页面
                    // 调用默认级联
                    ele_cascader("{$j}",[],0);
                    // 下单页需加载
                    ele_input("{$j}");
                    ele_brand_select("{$j}");
                    window.sunit["{$j}"].restaurants = [];
                }else if("{$html_name}" == 'edit' || "{$html_name}" == 'newOrder'){
                    unit_element_input("{$j}","{$pro_list[$j][spec_unit]}");
                    // 编辑页面
                    var n = 0;
                    // 装载级联选择器的默认选中项
                    var def = [];
                    // 遍历载入数据
                    def.push("{$pro_list[$j][category_one]}");
                    def.push("{$pro_list[$j][category_two]}");
                    ele_cascader("{$j}",def,0);
                    def = [];
                    ele_input("{$j}","{$pro_list[$j]['detail']}");
                    ele_brand_select("{$j}","{$pro_list[$j]['brand']}");
//                    // 规格/容量<单位>设置选中状态
//                    $(".spec_unit"+"{$j}").find("option[value='"+"{$pro_list[$j][spec_unit]}"+"']").attr("selected",true);
//                    // 数量<单位>设置选中状态
//                    $(".num_unit"+"{$j}").find("option[value='"+"{$pro_list[$j][num_unit]}"+"']").attr("selected",true);.
                }else{
                    unit_element_input("{$j}","{$pro_list[$j][spec_unit]}");
                    // 批量下单页面
                    var n = 0;
                    // 装载级联选择器的默认选中项
                    var def = [];
                    // 遍历载入数据
                    var category_one = "{$pro_list[$j][category_one]}";
                    var category_two = "{$pro_list[$j][category_two]}";
                    var res1,res2;
                    res1 = loop_cascader(globa_selec_gory.options,category_one);
                    category_one = res1[0];
                    if(res1[1] != undefined){
                        res2 = loop_cascader(res1[1],category_two);
                        category_two = res2[0];
                    }
                    def.push(category_one);
                    def.push(category_two);
                    ele_cascader("{$j}",def,0);
                    def = [];
                    ele_input("{$j}","{$pro_list[$j]['detail']}");
                    ele_brand_select("{$j}","{$pro_list[$j][brand]}");
                    // 规格/容量<单位>设置选中状态
//                    $(".spec_unit"+"{$j}").find("option[value='"+"{$pro_list[$j][spec_unit]}"+"']").attr("selected",true);
//                    // 数量<单位>设置选中状态
//                    $(".num_unit"+"{$j}").find("option[value='"+"{$pro_list[$j][is_suit]}"+"']").attr("selected",true);
                }
            });
        </script>
    </for>
    </table>
    <div onclick="copy_row(undefined,0)" id="copy_btn" class="btn" style="line-height: 22px;">{:L('l_add')}</div>
    <span class="forspan">{:L('Notice_Product')}</span>
    <h5 style="float: right;" id="contper">{:L('Total_Tax')}（$）：0.00</h5>
    <input type="hidden" value="{$free_duty}" id="free_duty">
    <!-- **************************************************** -->
    <!-- 按钮部分 -->
    <tr>
        <table style="width: 1335px;float: right;margin: 0 auto;">
            <tr>
                <td id="hide_boxs">
                    <input type="hidden" value="{$user_id}" name="uid">
                </td>
                <td style="text-align: right;">
                    <span id="loading" style="bottom:180px;left:650px !important;"></span>
                    <button type="submit" class="btn" id="BtnSave">{:L('BtnSave')}</button>
                    <!-- <button type="button" class="btn btn-default" data-dismiss="modal" id="beClosed">关闭</button> -->
                    <span id="messagebox" class="msgbox" style="bottom:180px;left:650px !important"></span>
                </td>
            </tr>
        </table>
    </tr>
</div>
</div>
<script type="text/javascript">
    var orderupload_url = "{:U('orderlist/import')}";
    var l_del_lng= "{:L('l_del')}";
</script>
<if condition="$html_name eq 'import'">
    <script type="text/javascript">
        $(function(){
            // 显示批量下单示例
            $('#table').before(excelcont(prolist));
            /**
             * 显示导入订单
             *
             * @method   显示导入订单的示例
             * @param   {obj} prolist  需要遍历显示的数据
             * @time    20180202
             * @author  gan
             */
            function excelcont(prolist){
                var str ='';
                str+='<table width="90%" border="0" cellpadding="10" cellspacing="10"  class="table table-hover" style="margin-left:0;color:#CC3366">';
                str+='<thead>';
                str+='<tr>';
                str += '<th>'+"{:L('l_Item_List')}"+'</th>';
                str += '<th>'+"{:L('l_Product_Name')}"+'</th>';
                str += '<th>'+"{:L('BrandName')}"+'</th>';
                str += '<th>'+"{:L('l_speci')}"+'</th>';
                // str += '<th>'+"{:L('Tax')}"+'</th>';
                str += '<th>'+"{:L('Amount')}"+'</th>';
                // str += '<th>'+"{:L('Unit')}"+'</th>';
                // str += '<th>'+"{:L('CountryOfOrigin')}"+'</th>';
                str += '<th>'+"{:L('l_Unit_Price')}"+'</th>';
                str+='</tr>';
                str+='</thead>';
                str+='<tbody>';
                $.each(prolist,function(k,v){
                    str+='<tr>';
                    str += '<td>'+v.category_one+'&nbsp;&nbsp;/&nbsp;&nbsp;'+v.category_two+'</td>';
                    str += '<td>'+v.detail+'</td>';
                    str += '<td>'+v.brand+'</td>';
                    str += '<td>'+v.catname+'&nbsp;&nbsp;/&nbsp;&nbsp;'+v.spec_unit+'</td>';
                    // str += '<td>***</td>';
                    str += '<td>'+v.number+'</td>';
                    // str += '<td>'+v.unit+'</td>';
                    // str += '<td>'+v.source_area+'</td>';
                    str += '<td>'+v.price+'</td>';
                    str+='</tr>';
                });
                str+='</tbody>';
                str+='</table>';
                return str;
            }
        });
    </script>
</if>
<script type="text/javascript">
    var order_info_lng = "{:L('l_other_information')}";
    var input_content_lng = "{:L('l_input_content')}";
    var categorys_lng = "{:L('l_Category1_Category2')}";
    var unit_lng = "{:L('l_Unit')}";
    // 声明判断当前页面属性（index,edit,newOrder）
    window.acname = "{$html_name}";
    var lay_del = "{:L('LAY_MesDel')}";
    var lay_btnok ="{:L('LAY_BtnOK')}";
    var lay_btncancel = "{:L('LAY_BtnCancel')}";
    var lay_information = "{:L('LAY_Information')}";
    var lay_systemmessage = "{:L('LAY_SystemMessage')}";
    var orderdel_url = "{:U('Order/del')}";
    var l_plan_unit = "{:L('l_plan_unit')}";
</script>
<script type="text/javascript" src="__MEMBER__/js/orderlist/cclist.js?v=20180608"></script>
<script type="text/javascript">
    $('#download_btn').click(function(){
        var lineid = $("input[name='TransferLine']:checked").val();
        var linename = $("input[name='TransferLine']:checked").next().text();
        // window.open(uploadexcel_url+'?line_id='+lineid+'&name='+linename);
        window.location.href="{:U('download/download_order_goods')}"+'?line_id='+lineid+'&name='+linename;
    });
    $("#uploadfile").fileinput({
        language: 'zh',
        uploadUrl: "{:U('orderlist/import')}",
        showCaption: false,     //是否显示被选文件的简介
        showPreview: false,     //是否显示预览区域
        showRemove: false,      //是否显示移除按钮
        showUpload: false,      //是否显示上传按钮
        browseClass: "fir_b",
        browseLabel: "{:L('l_imp_2')}",    //默认按钮
        validateInitialCount:false,
        browseIcon:'<i></i>',
        // initialPreview:"text files",
        allowedFileExtensions : ['xls','xlsx'],
        // 当文件上传成功后
    }).on("fileuploaded", function (event, data, previewId, index){
//        console.log(window.sunit);
        // 如果接收数据有值 则
        if(data.response.length != 0){
            var tr_ = $('.stta');
            // 倒序循环判断是否用户已填信息
            for(var i = tr_.length-1; i >= 0 ; i--){
                if(is_empty_line($(tr_[i]))){
                    $(tr_[i]).remove();
                }else{
                    break;
                }
            }

            $('#max_row').val($('.stta').length-1);
            var res1, res2;
            $.each(data.response,function(k,v){
                // 根据label的值进行分析 把对应的值进行赋值
                res1 = loop_cascader(globa_selec_gory.options,v.category_one);
                v.category_one = res1[0];
                if(res1[1] != undefined){
                    res2 = loop_cascader(res1[1],v.category_two);
                    v.category_two = res2[0];
                }

                copy_row(v,0);
            });
        }
        // 当文件选择后   
    }).on("filebatchselected",function(event, files){
        // 自动调用上传按钮
        $(this).fileinput("upload");
        // 删除进度条
        $('.kv-upload-progress').remove();
        $('.file-preview').remove();
        $('.fileinput-cancel').remove();
        var index = layer.load(1, {
            shade: [0.1,'#000'], //0.1透明度的白色背景
        });
        if(files.length == 0){
            layer.msg("{:L('l_Data_unqualified')}", {icon: 5});
        }
        layer.closeAll('loading');
    });

    /**
     * 计算税金
     *
     * @method  sum
     * @param   {} thisdom 所需的dom
     * @time    20180418
     * @author  gan
     *
     */
    //    function sumtax(thisdom){
    //        //################ 计算税金 ################ SATA
    //        // 税金的位置
    //        var showglod = thisdom.parent().parent().find('.chuijin').children();
    //        // 数量
    //        var aminput = thisdom.parent().parent().find('.amount').children().val();
    //        // 单价
    //        var uprice = thisdom.parent().parent().find('.price').children().val();
    //        // 选择中的税金
    //        var tax = thisdom.find('#cate_pirce').val();
    //        if(aminput != '' && uprice != ''){
    //            // 税金计算方法：数量*选中的金额*单价/100
    //            var upri =  (aminput*tax*uprice)/100;
    //            var percen = upri.toFixed(2);
    //            if(isNaN(percen)){
    //                $(showglod).html('0.00');
    //            }else{
    //                $(showglod).html(percen);
    //            }
    //            getsum();
    //        }
    //        //################ 计算税金 ################ END
    //    }

    /**
     * 单价计税
     *
     * @method   tax
     * @param   {object} obj 当前对象
     * @time    20180202
     * @author  gan
     */
    function priper(obj){
        var showglod = $(obj).parent('td').siblings('.chuijin').find('label');
        var thisv = $(obj).val();
        // var selpric = $(obj).parent('td').siblings('.seleopt').children().next().find("option:selected").attr("price");
        var selpric = $(obj).parent().siblings('.seleopt').find('#cate_pirce').val()
        var aminput = $(obj).parent('td').siblings('.amount').find('input').val();
        var upri =  (thisv*selpric*aminput)/100;
        var percen = upri.toFixed(2);
        if(isNaN(percen)){
            $(showglod).html('0.00');
        }else{
            $(showglod).html(percen);
        }
        // if(selpric != 0){
        //     $('.prinput').each(function(k,v){
        //         if($(v).val() != ''){
        //             console.log($(obj).length);

        //         }

        //     });
        // }else{
        //     alert('等于0');
        // }
        getsum();
    }

    /**
     * 数量计税
     *
     * @method   tax（计算方式：(税金*数量*单价)/100）
     * @param   {object} obj 当前对象
     * @time    20180202
     * @author  gan
     */
    function amper(obj){
        var showglod = $(obj).parent('td').siblings('.chuijin').find('label');
        var thisv = $(obj).val();
        // var selpric = $(obj).parent('td').siblings('.seleopt').children().next().find("option:selected").attr("price");
        var selpric = $(obj).parent().siblings('.seleopt').find('#cate_pirce').val();
        var priinput = $(obj).parent('td').siblings('.price').find('input').val();
        var upri =  (thisv*selpric*priinput)/100;
        var percen = upri.toFixed(2);
        if(isNaN(percen)){
            $(showglod).html('0.00');
        }else{
            $(showglod).html(percen);
        }
        getsum();
    }

    //    /**
    //     * 计算总价
    //     *
    //     * @method   sum
    //     * @time    20180202
    //     * @author  gan
    //     */
    //    var textbox = 0;
    //    function getsum(){
    //        textbox = 0;
    //        $('.chuijin').each(function(index, item) {
    //            textbox += parseFloat($(item).text()) || 0;
    //        });
    //        var freed = parseFloat($('#free_duty').val());
    //
    //        if((textbox.toFixed(2)) > freed){
    //            $('#contper').html("{:L('Total_Tax')}（$）："+textbox.toFixed(2));
    //        }else{
    //            $('#contper').html("{:L('Total_Tax')}（$）：<span style='color:red;'>{:L('Duty_Free')}</span>");
    //        }
    //    }

</script>