<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src="__MEMBER__/js/jquery-1.9.1.min.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
<script type="text/javascript" src="__MEMBER__/js/Vue/Vue.js"></script>
<!-- 引入样式 -->
<!-- <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"> -->
<link rel="stylesheet" href="__MEMBER__/js/Vue/Element/index.css">
<!-- 引入组件库 -->
<!-- <script src="https://unpkg.com/element-ui/lib/index.js"></script> -->
<script src="__MEMBER__/js/Vue/Element/index.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/search_area.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/zh-cn/area.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/zh-cn/location.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/select2.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/zh-cn/select2_locale_zh-CN.js"></script>
<script src="__MEMBER__/js/cityselectedtwo.js"></script>
<link rel="stylesheet" type="text/css" href="__MEMBER__/css/validationEngine.jquery.css">
<script src="__MEMBER__/js/jquery.validationEngine.js" type='text/javascript'></script>
<script src="__MEMBER__/js/jquery.validationEngine-{:L('lng')}.js" type='text/javascript'></script>
<link href="__MEMBER__/css/select2.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="__MEMBER__/css/save_res.css">
<link href="__MEMBER__/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<script type="text/javascript" src="__MEMBER__/js/jquery.form.js"></script>
<script src="__MEMBER__/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__MEMBER__/layer/layer.js"></script>
<script type="text/javascript">
        $(function(){
          $('#tempForm').validationEngine('attach', {
            promptPosition: 'topRight',
            scroll: false,
            addPromptClass:'formError-white',
            autoPositionUpdate: true,
            'custom_error_messages':{
                '#TransferLine':{
                    'required': {
                        'message': "{:L('valEng_Msg_fre')}",
                    }
                },
                '#loc_province':{
                    'required':{
                        'message': "{:L('valEng_Msg_fre')}",
                    }
                },
                '#loc_city':{
                    'required':{
                        'message': "{:L('valEng_Msg_fre')}",
                    }
                },
                '#loc_town':{
                    'required':{
                        'message': "{:L('valEng_Msg_fre')}",
                    }
                },
            }
          });
        });
</script>
</head>
<body>
<form action="{:U('Addressee/saveresseeAjax')}" method="POST" enctype="multipart/form-data" id="tempForm" onsubmit="Addresseeform(this)">
  <div class="warp">
    <div class="line">
      <label><span style="color:red">* </span>{:L('FullName')}：</label>
      <input type="text" value="{$info['name']}" data-validation-engine="validate[required,custom[chinalett]]" name="name" placeholder="{:L('Placeholder_RecName')}"  maxlength="40" class="value">
    </div>
    <div class="line">
      <label><span style="color:red">* </span>{:L('Phone')}：</label>
      <input type="text" value="{$info['tel']}" data-validation-engine="validate[required,custom[phone]]" name="tel" placeholder="{:L('Placeholder_RecPhone')}" class="value" maxlength="14">
    </div>
    <div class="line">
      <label><span style="color:red">* </span>{:L('DocumentsType')}：</label>
      <select name="cre_type" id="Id_tpye" class="form-control cre_type" <if condition='$info.status eq 10'>disabled style="background:#ececec;color:#8c8c8c;"</if>>
<!--           <volist name="type['data']" id="ty">
              <option value="{$ty['k']}">{$ty['v']}</option>
          </volist> -->
          <volist name="type" id="ty">
              <option value="{$key}">{:L($ty)}</option>
          </volist>
      </select>
      <input type="text" name="cre_num" placeholder="{:L('Placeholder_IdNo')}" id="idno" data-validation-engine="validate[required,custom[chinaId]]" maxlength="18" class="value" value="{$info['cre_num']}" <if condition="$info.status eq 10">disabled style="background:#ececec;color:#8c8c8c;"</if>>
      
    </div>
    <div class="line">
      <label><span style="color:red">* </span>{:L('Address')}：</label>
        <div id="re_area" style="display: inline-block;">
            <div class="block">
                <el-cascader clearable v-model="selectedOptions" placeholder="{:L('l_Search_pcd')}" :options="options" filterable @change="handleChange"></el-cascader>
            </div>
        </div>
        <input id="province" name="province" value="{$info['province']}" style="display: none" data-validation-engine="validate[required]"/>
        <input id="city" name="city" value="{$info['city']}" style="display: none" data-validation-engine="validate[required]"/>
        <input id="town" name="town" value="{$info['town']}" style="display: none" data-validation-engine="validate[required]"/>
    </div> 
    <div class="line">
      <label><span style="color:red">* </span>{:L('DetaileAddress')}：</label>
      <input type="text" value="{$info['address']}" data-validation-engine="validate[required,custom[repadd]]"  name="address" placeholder="{:L('Placeholder_RecAddress')}" maxlength="80" class="detail-add">
    </div>
    <div class="line">
      <label><span style="color:red">* </span>{:L('ZipCode')}：</label>
      <input type="text" value="{$info['postal_code']}" data-validation-engine="validate[required,custom[chinaZip]]" name="postal_code" placeholder="{:L('Placeholder_RecCode')}" maxlength="10" class="value">
    </div> 
        <div class="line">
      <label>{:L('l_addr_tag')}：</label>
      <input type="text" value="{$info['address_alias']}" name="address_alias" class="value" placeholder="{:L('l_enter_addr_tag')}"><br>
      <label>({:L('l_not_set')})</label>
    </div>
    <div class="line">
      <label>{:L('l_def_line')}：</label>
      <select name="line_id" class="form-control lineselect" id="line_id">
          <option value="">{:L('l_default_mail_route')}</option>
          <volist name="line" id="vo">
              <option value="{$vo['id']}"><php>$l = L('MKLINES');echo $l[$vo['lngname']];</php></option>
          </volist>
      </select><br>
      <label style="font-size: 12px;">（{:L('l_ no_choice')}）</label>
    </div> 
    <div class="ordbody">
      <div class="obconts">
          <p>{:L('Cer_Pho_Front')}</p>
          <img src="{$info['id_card_front']}" id="fileimage2" style="width: 230px;height: 120px;margin-left: 15px;">
          <if condition="$info.status eq 10">
            <label style="background:#ececec;color:#8c8c8c;">{:L('l_audited')}</label>
          <else />
            <input type="file" name="id_card_front" id="files" accept="image/jpeg,image/jpg,image/png" atd="2" onclick="fileOnchange(this)" />
            <label>{:L('Cer_Btn')}</label>
          </if>

      </div>
      <div class="obcont">
          <p>{:L('Cer_Pho_Back')}</p>
          <img src="{$info['id_card_back']}" id="fileimage1" style="width: 230px;height: 120px;margin-left: 15px;">
          <if condition="$info.status eq 10">
            <label style="background:#ececec;color:#8c8c8c;">{:L('l_audited')}</label>
          <else />
            <input type="file" name="id_card_back" id="file" accept="image/jpeg,image/jpg,image/png" atd="1" onclick="fileOnchange(this)" />
            <label>{:L('Cer_Btn')}</label>
          </if>
      </div>
    </div>
    <div style="clear:both;"></div>
    <input type="hidden" name="id" value="{$info['id']}">
    <div class="savebtn">
      <input type="submit" value="{:L('BtnSave')}" class="sa_sub_btn">
    </div>     
  </div>
</form>
<script type="text/javascript">
    // 选择线路特效
    $(document).ready(function(){
    // 生成地址
    var Main = {
        data: function data() {
            return search_area;
        },

        methods: {
            handleChange: function handleChange(val) {
                var pro_val = String(val[0]);
                var cit_val = String(val[1]);
                var tow_val = String(val[2]);

                $('#province').val(pro_val);
                $('#city').val(cit_val);
                $('#town').val(tow_val);
            }
        }
    };
    var Ctor = Vue.extend(Main);
    new Ctor().$mount('#re_area');
        // 这是后台返回的省市区，把它们都分别赋值到那三个select上面显示
        var p = "{$info['province']}";
        var c = "{$info['city']}";
        var t = "{$info['town']}";
        search_area.selectedOptions = [p,c,t];



        $('#Id_tpye').val("{$info['cre_type']}");
        $('#line_id').val({$info['line_id']});
        var chid= $('#Id_tpye').val();
        if(chid == 'PASPORT'){
            $('#idno').attr("placeholder","{:L('Placeholder_IdPT')}");
            $('#idno').attr("maxlength","10");
            $('#idno').attr("data-validation-engine","validate[required]");
        }else if(chid == 'ID'){
            $('#idno').attr("placeholder","{:L('Placeholder_IdNo')}");
            $('#idno').attr("maxlength","18");
            $('#idno').attr("data-validation-engine","validate[required,custom[chinaId]]");
        }       
        // 证件类型
        $("#Id_tpye").change(function(){
            var chid= $('#Id_tpye').val();
            if(chid == 'PASPORT'){
                $('#idno').attr("placeholder","{:L('Placeholder_IdPT')}");
                $('#idno').attr("maxlength","10");
                $('#idno').attr("data-validation-engine","validate[required]");
            }else if(chid == 'ID'){
                $('#idno').attr("placeholder","{:L('Placeholder_IdNo')}");
                $('#idno').attr("maxlength","18");
                $('#idno').attr("data-validation-engine","validate[required,custom[chinaId]]");
            }
        });
    });
    // 文件上传赋值到对应图片位置
    function fileOnchange(pid){
        var atd = pid.getAttribute("atd");
        // alert(atd);
        var input = pid;

        var res = document.getElementById("fileimage"+atd);       
        if(typeof FileReader==='undefined'){
            res.innerHTML = "抱歉，你的浏览器不支持 FileReader"; 
            input.setAttribute('disabled','disabled'); 
        }else{
            input.addEventListener('change',readFile,false);
        }

        //图片文件读取
        function readFile(){ 
            var file = this.files[0];
            // console.log(file);
            if(!/image\/\w+/.test(file.type)){ 
                layer.open({
                  type: 0, 
                  skin: 'demo-class',//自定义样式demo-class
                  title: false,
                  content: "{:L('Up_Documents')}"
                });
                return false; 
            } 
            var reader = new FileReader(); 
            reader.readAsDataURL(file); 
            reader.onload = function(e){ 
                res.src = this.result;  //赋值到src
            } 
        }
    }
    // 通过JQform提交
    function Addresseeform(obj){
        $(window).unbind('beforeunload');
        if(!$("#tempForm").validationEngine("validate")) return ;
        $(obj).ajaxForm({
            dataType: 'json',
            beforeSend:function(){
                var index = layer.load(1, {
                    shade: [0.1,'#000'], //0.1透明度的白色背景
                    offset: '450px',
                });
            },
                success: function(data){
                    if(data.success == false){
                        layer.closeAll('loading'); //关闭加载层
                        layer.open({
                            type: 0,
                            offset: '300px',
                            shadeClose: true,
                            skin: 'demo-class',//自定义样式demo-class
                            title: "{:L('LAY_SystemMessage')}",
                            content : data.info,
                            icon : 5
                        });
                        return false;
                    }else{
                        layer.closeAll('loading'); //关闭加载层.
                        window.parent.location.href=data.url; //刷新父页面
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    }
                }
        });
    }
</script>
</body>
</html>