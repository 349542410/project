<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="__MEMBER__/js/jquery-1.9.1.min.js"></script>
    <link rel="stylesheet" href="__MEMBER__/css/member/record_upload.css?t=20180702"/>
    <link rel="stylesheet" type="text/css" href="__MEMBER__/css/validationEngine.jquery.css">
    <script type="text/javascript" src="__MEMBER__/layer/layer.js"></script>
    <script src="__MEMBER__/js/jquery.validationEngine.js" type='text/javascript'></script>
    <script src="__MEMBER__/js/jquery.validationEngine-{:L('lng')}.js" type='text/javascript'></script>
    <script type="text/javascript" src="__MEMBER__/js/jquery.form.js"></script>
    <script type="text/javascript" src="__MEMBER__/layer/layer.js"></script>
    <script type="text/javascript">
        $(function(){$("#tempForm").validationEngine("attach",{promptPosition:"topRight",scroll:!1,addPromptClass:"formError-white",autoPositionUpdate:!0,custom_error_messages:{"#TransferLine":{required:{message:"{:L('valEng_Msg_fre')}"}},"#loc_province":{required:{message:"{:L('valEng_Msg_fre')}"}},"#loc_city":{required:{message:"{:L('valEng_Msg_fre')}"}},"#loc_town":{required:{message:"{:L('valEng_Msg_fre')}"}}}})});
    </script>
</head>
<body>
<form action="{:U('Member/idcard_update')}" method="POST" enctype="multipart/form-data" id="tempForm" onsubmit="record_uploadform(this)">
    <input type="hidden" name="order_id" value="{:I('get.id')}"/>
    <div class="warp">
        <div class="tab">
            <div class="table_menu">
                <ul class="tabel_ul">
                    <li class="selected">{:L('l_upload_by_s')}</li>
                    <li>{:L('l_upload_by_r')}</li>
                </ul>
            </div>
            <div class="tab_box">
                <div class="tab_one">
                    <div class="line">
                        <label>{:L('l_receiver_id')}：</label><input type="text" name="idno" placeholder="{:L('l_receiver_ID_number')}" class="idno_input" value="{:I('get.idno')}" />
                    </div>
                    <span class="tab_one_span"><span class="bule0099ff">*</span>{:L('l_upload_cont')}</span>
                        <div class="obconts">
                            <p>{:L('l_back_id_card')}</p>
                            <img src='__MEMBER__/images/pho_back.png' id="front_idno2">
                            <input type="file" name="file_two" id="files" accept="image/jpeg,image/jpg,image/png" atd="2" onclick="fileOnchange(this)" />
                            <label>{:L('Cer_Btn')}</label>
                        </div>
                        <div class="obcont">
                            <p>{:L('l_front_id_card')}</p>
                            <img src='__MEMBER__/images/pho_front.png' id="front_idno1">
                            <input type="file" name="file_one" id="file" accept="image/jpeg,image/jpg,image/png" atd="1" onclick="fileOnchange(this)" />
                            <label>{:L('Cer_Btn')}</label>
                        </div>
                        <div style="clear: both;"></div>
                        <div class="savebtn">
                            <input type="submit" value="{:L('ToSubmit')}" class="sa_sub_btn error_btn" id="sa_sub_btn">
                        </div>
                </div>
                <div class="hide tab_two">
                    <p class="tt_p"><span class="bule0099ff">*</span>{:L('l_reconrd_two_cont')}</p>
                    <div class="cont">
                        <ul>
                            <li>
                                <i class="icon_pc"></i><label>{:L('l_pc_upload_line')}：</label><input type="text" id="pcobj" class="pcobj" value="" ><a href="javascript:;" class="copy_btn" onclick="copyurl(1)">{:L('l_copy_line')}</a>
                            </li>
                            <li>
                                <i class="icon_wap"></i><label>{:L('l_wap_upload_line')}：</label><input type="text" id="wapobj" class="wapobj" value="{:C('ID_URL_M')}"><a href="javascript:;" class="copy_btn" onclick="copyurl()">{:L('l_copy_line')}</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">
    $(function(){
        var id = '{:I("get.id")}';
        $.get('{:U("Member/getKey")}', {id:id}, function (data) {
            $("#pcobj").attr('value', "{:C('ID_URL')}I" + data);
            $("#wapobj").attr('value',"{:C('ID_URL_M')}I" + data);
        })

        var idno_val = $('input[name="idno"]').val();
        if(idno_val != ''){
            $('#sa_sub_btn').removeClass('error_btn');
            $('#sa_sub_btn').addClass('success_btn');
        }else{
            $('#sa_sub_btn').removeClass('success_btn');
            $('#sa_sub_btn').addClass('error_btn');
        }
        $("input[name='idno']").bind('input propertychange',function(){
            var myval = $(this).val();
            if(myval != ''){
                $('#sa_sub_btn').removeClass('error_btn');
                $('#sa_sub_btn').addClass('success_btn');
                $('#sa_sub_btn').attr('type','submit');
            }else{
                $('#sa_sub_btn').removeClass('success_btn');
                $('#sa_sub_btn').addClass('error_btn');
                $('#sa_sub_btn').attr('type','button');
            }
        });
        var $div_li=$("div .table_menu ul li");
        //设置li的单击事件
        $div_li.click(function(){
            //设置li单击时的样式
            $(this).addClass("selected")
                    .siblings().removeClass("selected");
            //记录当前点击li的index
            var index=$div_li.index(this);
            //选择与li相同index的div显示，其余隐藏
            $("div .tab_box >div")
                    .eq(index).show()
                    .siblings().hide();
        });
    });
    // 文件上传赋值到对应图片位置
    function fileOnchange(pid,def){

        var atd = pid.getAttribute("atd");
        var input = pid;

        var res = document.getElementById("front_idno"+atd);

        if(typeof FileReader==='undefined'){
            res.innerHTML = "抱歉，你的浏览器不支持 FileReader";
            input.setAttribute('disabled','disabled');
        }else{
            input.addEventListener('change',readFile,false);
        }

        // 图片文件读取
        function readFile(){
            var file = this.files[0];
            if(file){
                if(!/image\/\w+/.test(file.type)){
                    layer.open({
                        type: 0,
                        title: false,
                        skin: 'demo-class',//自定义样式demo-class
                        content: "{:L('Up_Documents')}"
                    });
                    return false;
                }
                var reader = new FileReader();

                reader.readAsDataURL(file);
                reader.onload = function(e){
                    res.src = this.result;  //赋值到src
                };
            }else{
//                var front_img = '__MEMBER__/images/pho_front.png';
//                var back_img = '__MEMBER__/images/pho_back.png';
//                var tip_img= '__MEMBER__/images/tip.png';
//                if(atd == 1){
//                    $(def).attr('src',front_img);
//                }else if(atd == 2){
//                    $(def).attr('src',back_img);
//                }else{
//                    $(def).attr('src',tip_img);
//                }

            }
        }
    }

    /**
     *
     * 复制到剪切板
     *
     */
    function copyurl(nub){
        if(nub === 1){
            $('#pcobj').select();
        }else{
            $('#wapobj').select();
        }
        document.execCommand('Copy');
        layer.msg('{:L("l_copy_success")}');
    }
    // 通过JQform提交
    function record_uploadform(obj){
        $(obj).ajaxForm({
            dataType: 'json',
            beforeSend:function(){
                var index = layer.load(1, {
                    shade: [0.1,'#000'], //0.1透明度的白色背景
                    skin: 'demo-class',//自定义样式demo-class
                });
            },
            success: function(data){
                if(data.status == false){
                    layer.closeAll('loading'); //关闭加载层
                    layer.open({
                        type: 0,
                        shadeClose: true,
                        skin: 'demo-class',//自定义样式demo-class
                        title: "{:L('LAY_SystemMessage')}",
                        content : data.err_info,
                        icon : 5
                    });
                    return false;
                }else{
                    layer.closeAll('loading'); //关闭加载层.
                    layer.msg("{:L('l_fill_msg')}");
                    var index = parent.layer.getFrameIndex(window.name);
                    setInterval(function(){
                        parent.layer.close(index);
                    },500);
                    window.parent.location.href = "{:U('Member/index')}?p={:I('page')}"; //刷新父页面

                }
            }
        });
    }
</script>
</body>
</html>