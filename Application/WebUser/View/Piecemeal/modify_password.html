<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="__MEMBER__/js/jquery-1.9.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="__MEMBER__/css/validationEngine.jquery.css">
    <link href="__MEMBER__/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="__MEMBER__/css/repwd.css">
    <script src="__MEMBER__/bootstrap/js/bootstrap.min.js"></script>
    <script src="__MEMBER__/js/jquery.validationEngine.js" type='text/javascript'></script>
    <script src="__MEMBER__/js/jquery.validationEngine-{:L('lng')}.js" type='text/javascript'></script>  
    <script type="text/javascript" src="__MEMBER__/js/jquery.form.js"></script>
    <script type="text/javascript" src="__MEMBER__/layer/layer.js"></script>
</head>
<body>
    <form id="myssform" action="{:U('Piecemeal/check_pwd_ajax')}" method="POST" onsubmit="piecemealform(this)">
        <ul class="ul" <if condition="(L('lng') eq 'en-us')"> style="width:85%;"</if>>
            <li><label <if condition="(L('lng') eq 'en-us')"> style="width:223px;"</if>>{:L('l_ori_pwd')}：</label><input type="password" name="old_pwd" value="" maxlength="16" class="validate[required,minSize[6],maxSize[16]]"></li>
            <li><label <if condition="(L('lng') eq 'en-us')"> style="width:223px;"</if>>{:L('Rd_New_password')}：</label><input type="password" name="new_pwd" value="" maxlength="16" id="npwd" class="validate[required,minSize[6],maxSize[16]]"></li>
            <li><label <if condition="(L('lng') eq 'en-us')"> style="width:223px;"</if>>{:L('Rd_New_password_s')}：</label><input type="password" name="re_new_pwd" value="" maxlength="16" class="validate[required,equals[npwd]]"></li>
            <li><label <if condition="(L('lng') eq 'en-us')"> style="width:223px;"</if>>{:L('Rd_Verif_code')}：</label><input type="text" name="captcha" maxlength="4" class="validate[required]" value="" ></li>
            <li class="verintp"><img <if condition="(L('lng') eq 'en-us')"> style="margin-left:223px;"</if> width="100px" id="verify" height="45px" alt="{:L('Rd_Verif_code')}" src="{:U('Piecemeal/verify_c',array())}" title="{:L('Rd_Click_refresh')}" onclick="this.src='__URL__/verify_c/'+Math.round(new Date().getTime()/1000)"></li>
        </ul>         
        <div class="lastsub"><input type="submit" value="{:L('ToSubmit')}" class="sub" ></div>
    </form>
<script type="text/javascript">
$(function(){
	$('#myssform').validationEngine('attach', {
      maxErrorsPerField: 1,
      promptPosition: 'centerRight',
      addPromptClass: 'formError-text',
	  scroll: false
	});
});
// 通过JQform提交
function piecemealform(obj){
    $(window).unbind('beforeunload');
    if(!$("#myssform").validationEngine("validate")) return ;
    $(obj).ajaxForm({
        dataType: 'json',
        beforeSend:function(){
            var index = layer.load(1, {
                shade: [0.1,'#000'], //0.1透明度的白色背景
                offset: '450px',
            });
        },
        success: function(data){
            //console.log(data);
            if(data.success == false){
                layer.closeAll('loading'); //关闭加载层
                layer.open({
                    type: 0,
                    offset: '100px',
                    shadeClose: true,
                    skin: 'demo-class',//自定义样式demo-class
                    content : data.info,
                    icon : 5,
                });
                $('.verintp img').attr('src','__URL__/verify_c/'+Math.round(new Date().getTime()/1000))
                return false;
            }else{
                layer.closeAll('loading'); //关闭加载层.
                // window.parent.location.href=data.url;; //刷新父页面
                layer.msg(data.info);
                var index = parent.layer.getFrameIndex(window.name);  
                setTimeout(function(){parent.layer.close(index)},1000);
            }
        }
    });
}
</script>
</body>
</html>