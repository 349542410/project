<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src="__MEMBER__/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/zh-cn/area.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/zh-cn/location.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/select2.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/zh-cn/select2_locale_zh-CN.js"></script>
<script src="__MEMBER__/js/cityselectedtwo.js"></script>
<link rel="stylesheet" type="text/css" href="__MEMBER__/css/validationEngine.jquery.css">
<script src="__MEMBER__/js/jquery.validationEngine.js" type='text/javascript'></script>
<script src="__MEMBER__/js/jquery.validationEngine-{:L('lng')}.js" type='text/javascript'></script>
<link href="__MEMBER__/css/select2.css" rel="stylesheet"/>
<link href="__MEMBER__/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="__MEMBER__/css/add_res.css">
<script type="text/javascript" src="__MEMBER__/js/jquery.form.js"></script>
<script src="__MEMBER__/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__MEMBER__/layer/layer.js"></script>
<script type="text/javascript">
  $(function(){
    $('#tempForm').validationEngine('attach', {
      promptPosition: 'topRight',
      scroll: false,
      addPromptClass:'formError-white',
      autoPositionUpdate: true,
      'custom_error_messages':{
          '#TransferLine':{
              'required': {
                  'message': "{:L('valEng_Msg_fre')}",
              }
          },
          '#loc_province':{
              'required':{
                  'message': "{:L('valEng_Msg_fre')}",
              }
          },
          '#loc_city':{
              'required':{
                  'message': "{:L('valEng_Msg_fre')}",
              }
          },
          '#loc_town':{
              'required':{
                  'message': "{:L('valEng_Msg_fre')}",
              }
          },
      }
    });
  });
</script>
</head>
<body>
<form action="{:U('Addressee/addresseeAjax')}" method="POST" enctype="multipart/form-data" id="tempForm" onsubmit="tempform(this)">
  <div class="warp">
    <div class="line">
      <label>{:L('FullName')}：</label>
      <input type="text" value="" data-validation-engine="validate[required,custom[chinalett]]" name="name" placeholder="{:L('Placeholder_RecName')}"  maxlength="40" class="value">
    </div>
    <div class="line">
      <label>{:L('Phone')}：</label>
      <input type="text" value="" data-validation-engine="validate[required,custom[phone]]" name="tel" placeholder="{:L('Placeholder_RecPhone')}" class="value" maxlength="14">
    </div>
    <div class="line">
      <label>{:L('DocumentsType')}：</label>
      <select name="cre_type" id="Id_tpye">
<!--           <volist name="type['data']" id="ty">
              <option value="{$ty['k']}">{$ty['v']}</option>
          </volist> -->
          <volist name="type" id="ty">
              <option value="{$key}">{:L($ty)}</option>
          </volist>
      </select>
      <input type="text" name="cre_num" placeholder="{:L('Placeholder_IdNo')}" id="idno" data-validation-engine="validate[required,custom[chinaId]]" maxlength="18" class="value">
    </div>
    <div class="line">
      <label>{:L('Address')}：</label>
        <select id="loc_province" style="width:100px;" data-validation-engine="validate[required]">
        </select>
        <select id="loc_city" style="width:115px; margin-left: 5px" data-validation-engine="validate[required]">
        </select>
        <select id="loc_town" style="width:115px;margin-left: 5px" data-validation-engine="validate[required]">
        </select>
        <input id="province" name="province" value="" style="display: none" />
        <input id="city" name="city" value="" style="display: none" />
        <input id="town" name="town" value="" style="display: none" />
    </div> 
    <div class="line">
      <label>{:L('DetaileAddress')}：</label>
      <input type="text" value="" data-validation-engine="validate[required,custom[repadd]]"  name="address" placeholder="{:L('Placeholder_RecAddress')}" maxlength="80" class="detail-add">
    </div>
    <div class="line">
      <label>{:L('l_addr_tag')}：</label>
      <input type="text" name="address_alias" class="value" placeholder="{:L('l_enter_addr_tag')}" data-validation-engine="validate[required]">
    </div>
    <div class="line">
      <label>{:L('ZipCode')}：</label>
      <input type="text" value="" data-validation-engine="validate[required,custom[chinaZip]]" name="postal_code" placeholder="{:L('Placeholder_RecCode')}" maxlength="10" class="value">
    </div> 
    <div class="line">
      <label>{:L('l_def_line')}：</label>
      <select name="line_id" class="form-control lineselect">
          <option value="">{:L('PleaseSelectLine')}</option>
          <volist name="line" id="vo">
              <option value="{$vo['id']}"><php>$l = L('MKLINES');echo $l[$vo['lngname']];</php></option>
          </volist>
      </select>
    </div> 
    <div class="ordbody">
      <div class="obconts">
          <p>{:L('Cer_Pho_Front')}</p>
          <img src='__MEMBER__/images/pho_back.png' id="fileimage2" style="width: 230px;height: 120px;margin-left: 15px;">
          <input type="file" name="id_card_front" id="files" accept="image/jpeg,image/jpg,image/png" atd="2" onclick="fileOnchange(this)" />
          <label>{:L('Cer_Btn')}</label>
      </div>
      <div class="obcont">
          <p>{:L('Cer_Pho_Back')}</p>
          <img src='__MEMBER__/images/pho_front.png' id="fileimage1" style="width: 230px;height: 120px;margin-left: 15px;">
          <input type="file" name="id_card_back" id="file" accept="image/jpeg,image/jpg,image/png" atd="1" onclick="fileOnchange(this)" />
          <label>{:L('Cer_Btn')}</label>
      </div>
    </div>
    <div style="clear:both;"></div>
    <div class="savebtn">
      <input type="submit" value="{:L('BtnSave')}" class="sa_sub_btn">
    </div>     
  </div>
</form>
<script type="text/javascript">
    $(document).ready(function(){
        // 证件类型
        var chid= $('#Id_tpye').val();
        if(chid == 'PASPORT'){
            $('#idno').attr("placeholder","{:L('Placeholder_IdPT')}");
            $('#idno').attr("maxlength","10");
            $('#idno').attr("data-validation-engine","validate[required]");
        }else if(chid == 'ID'){
            $('#idno').attr("placeholder","{:L('Placeholder_IdNo')}");
            $('#idno').attr("maxlength","18");
            $('#idno').attr("data-validation-engine","validate[required,custom[chinaId]]");
        }       
        // 证件类型
        $("#Id_tpye").change(function(){
            var chid= $('#Id_tpye').val();
            if(chid == 'PASPORT'){
                $('#idno').attr("placeholder","{:L('Placeholder_IdPT')}");
                $('#idno').attr("maxlength","10");
                $('#idno').attr("data-validation-engine","validate[required]");
            }else if(chid == 'ID'){
                $('#idno').attr("placeholder","{:L('Placeholder_IdNo')}");
                $('#idno').attr("maxlength","18");
                $('#idno').attr("data-validation-engine","validate[required,custom[chinaId]]");
            }
        });
    });
    // 文件上传赋值到对应图片位置
    function fileOnchange(pid){
        var atd = pid.getAttribute("atd");
        // alert(atd);
        var input = pid;

        var res = document.getElementById("fileimage"+atd);       
        if(typeof FileReader==='undefined'){
            res.innerHTML = "抱歉，你的浏览器不支持 FileReader"; 
            input.setAttribute('disabled','disabled'); 
        }else{
            input.addEventListener('change',readFile,false);
        }

        //图片文件读取
        function readFile(){ 
            var file = this.files[0];
            // console.log(file);
            if(!/image\/\w+/.test(file.type)){ 
                layer.open({
                  type: 0, 
                  title: false,
                  content: "{:L('Up_Documents')}"
                });
                return false; 
            } 
            var reader = new FileReader(); 
            reader.readAsDataURL(file); 
            reader.onload = function(e){ 
                res.src = this.result;  //赋值到src
            } 
        }
    }
    // 通过JQform提交
    function tempform(obj){
        $(window).unbind('beforeunload');
        if(!$("#tempForm").validationEngine("validate")) return ;
        $(obj).ajaxForm({
            dataType: 'json',
            beforeSend:function(){
                var index = layer.load(1, {
                    shade: [0.1,'#000'], //0.1透明度的白色背景
                    offset: '450px',
                });
            },
            success: function(data){
                console.log(data);
                if(data.insert.success == false){
                    layer.closeAll('loading'); //关闭加载层
                    layer.open({
                        type: 0,
                        offset: '300px',
                        shadeClose: true,
                        title: "{:L('LAY_SystemMessage')}",
                        content : data.insert.info,
                        icon : 5,
                    });
                    return false;
                }else if(data.img.success == false){
                    layer.closeAll('loading'); //关闭加载层
                    layer.open({
                        type: 0,
                        offset: '300px',
                        shadeClose: true,
                        title: "{:L('LAY_SystemMessage')}",
                        content : data.img.info,
                        icon : 5,
                    });
                    return false;
                }else{
                    layer.closeAll('loading'); //关闭加载层.
                    window.parent.location.href=data.url;; //刷新父页面
                    var index = parent.layer.getFrameIndex(window.name);  
                    parent.layer.close(index);
                }
            }
        });
    }
</script>
</body>
</html>