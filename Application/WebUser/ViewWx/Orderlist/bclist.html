				<div class="ordhead"><h3>{:L('GoodsList')}</h3></div>
					<div class="goodshow">
					<input type="hidden" id="num" value="{$count-1}" autocomplete="off">
						<for start="0" end="$count" name="j"> 
							<ul id="table" class="goodsbox">
								<input class="ttc" type="hidden" name="oid_{$j}" value="{$pro_list[$j][oid]}"/>
								<!-- 品牌 -->
								<li style="display: none;" class="brand"><label>{:L('BrandName')}：</label><input type="text" name="brand_{$j}" class="clchang" value="{$pro_list[$j]['brand']}"></li>
								<!-- 货品名称 -->
								<li style="display: none;" class="detail"><label>{:L('ProductName')}：</label><input type="text" name="detail_{$j}" class="clchang" value="{$pro_list[$j]['detail']}"></li>
								<!-- 货品类别 -->
								<li style="display: none;" class="catname"><label>{:L('ProCate')}：</label><input type="text" name="catname_{$j}" class="clchang" value="{$pro_list[$j]['catname']}"></li>
								<!-- bc品牌select -->
								<li><label>{:L('BrandName')}：</label>
									<select name="category_one_{$j}" <if condition="$j eq 0">data-validation-engine="validate[required]"</if> onchange="selecchang(this)">
										<option value="">{:L('ClassOne')}</option>
										<volist name="cat_list" id="vvo">
											<php>
	                                        if($vvo['id'] == $pro_list[$j]['category_one']){
	                                            $catoid = $vvo['id'];
	                                        }
	                                        </php>
	                                        <option value="{$vvo['id']}" <if condition="$vvo['id'] eq $pro_list[$j]['category_one']">selected</if>>{$vvo['cat_name']}</option>
	                                    </volist>
									</select>
								</li>
								<!-- bc货品名称select -->
								<li><label>{:L('ProductName')}：</label>
									<select style="width:120px;" class="cattwo" name="category_two_{$j}" onchange="selectc(this)">
	                                    <option value="">{:L('ClassTwo')}</option>
	                                    <volist name="cat_list[$catoid]['child']" id="vvto">
	                                        <php>
	                                        if($vvto['id'] == $pro_list[$j]['category_two']){
	                                            $price = $vvto['price'];
	                                            $num = $pro_list[$j]['number'];
	                                            $product_id = $pro_list[$j]['product_id'];
	                                        }
	                                        </php>
	                                        <option value="{$vvto['id']}" price="{$vvto['price']}" <if condition="$vvto['id'] eq $pro_list[$j]['category_two']">selected</if>  pic="{$product_id}">{$vvto['cat_name']}</option>
	                                    </volist>
	                                </select>
								</li>
								<!-- bc货品类别select -->
								<li class="pidc"><label>{:L('ProCate')}：</label>
									<select name="product_type_{$j}" onchange="selelast(this)" style="width:100px;">
	                                <option value="">{:L('ProCate')}</option>
	                                </select>
								</li>
								<!-- bc状态 可用税金 -->
                            	<li class="chuijin"><label>{:L('Tax')}（$）：</label><label class="shuijinshow">0.00</label></li>
								<!-- 数量 -->
								<li class="flaotl ordsmli amount"><label>{:L('Amount')}：</label><input type="text" name="amount_{$j}" class="clzhong" value="{$pro_list[$j]['number']}" <if condition="$j eq 0">data-validation-engine="validate[required]"</if>></li>
								<!-- 单价 -->
								<li class="flaotl ordsmli"><label>{:L('UnitPrice')}（$）：</label><input type="text" name="price_{$j}" class="clzhong" value="{$pro_list[$j]['price']}" <if condition="$j eq 0">data-validation-engine="validate[required]"</if>></li>
								<!-- 货币 -->
								<input type="hidden" name="coin_{$j}" value="USD">
<!-- 								<li class="flaotl ordsmli">
									<label>{:L('Currency')}：</label>
									<select name="coin_{$j}" id="" class="clduan">
										<option value="USD" selected="selected">$</option>
									</select>
								</li> -->
								<!-- 备注 -->
								<li class="flaotl ordsmli marbot"><label>{:L('Remarks')}：</label><input type="text" name="remark_{$j}" class="clzhong" value="{$pro_list[$j]['remark']}"></li>
								<div style="clear: both;"></div>
							</ul>
						</for>
					</div>
					<span class="ordbtn"><a onclick="copy_row(this)" href="javascript:void(0)">+</a></span>
				<!-- 按钮部分 -->
				<table style="width: 100%;float: right;margin: 0 5%;">
					<tr>
						<td id="hide_boxs">
							<input type="hidden" value="{$user_id}" name="uid">
						</td>
						<td style="text-align: right;">
							<span id="loading" style="bottom:180px;left:650px !important;"></span>
							<button type="submit" class="btn" id="BtnSave">{:L('BtnSave')}</button>
							<!-- <button type="button" class="btn btn-default" data-dismiss="modal" id="beClosed">关闭</button> -->
							<span id="messagebox" class="msgbox" style="bottom:180px;left:650px !important"></span>					
						</td>
					</tr>
				</table>
				<!-- END -->	
		    	<div style="clear:both;"></div>
<script type="text/javascript">
    $(function(){
        var acname = "{$html_name}";
        //alert(ppp);
        if(acname != 'index'){
            $('.cattwo').change();         
        }
    });
	// 添加删除行 20170316 gan
	function copy_row(obj)
	{
		layer.open({
			title:false,
			btn:false,
			closeBtn:0,
			shadeClose:true,
			time:500,
			content:"<p style='text-align:center'>添加成功！</p>",
			offset: '300px'
		});
		var num=$("#num").val();
		num++;
		if(num>=10){
			layer.open({
				title:"{:L('LAY_SystemMessage')}",
				offset: '300px',
				icon : 0,
				content: "{:L('LAY_AddRow')}",
			});
			$('.copy_r').find('a').remove();
		}
		var str='<ul id="table" class="goodsbox"><input class="ttc" type="hidden" name="oid_'+num+'" value="{$pro_list[$j][oid]}"/><li style="display:none" class="brand"><label>{:L("BrandName")}：</label><input type="text" name="brand_'+num+'" class="clchang"></li><li style="display:none" class="detail"><label>{:L("ProductName")}：</label><input type="text" name="detail_'+num+'" class="clchang"></li><li style="display:none" class="catname"><label>{:L("ProCate")}：</label><input type="text" name="catname_'+num+'" class="clchang"></li><li><label>'+"{:L('BrandName')}"+'：</label><select name="category_one_'+num+'" <if condition="$j eq 0">data-validation-engine="validate[required]"</if> onchange="selecchang(this)"><option value="">{:L('ClassOne')}</option><volist name="cat_list" id="vvo"><option value="'+"{$vvo['id']}"+'" <if condition="$vvo['id'] eq $pro_list[$j]['category_one']">selected</if>>'+"{$vvo['cat_name']}"+'</option></volist></select></li><li><label>'+"{:L('ProductName')}"+'：</label><select style="width:120px;" class="cattwo" name="category_two_'+num+'" onchange="selectc(this)"><option value="">'+"{:L('ClassTwo')}"+'</option><volist name="cat_list[$catoid]['child']" id="vvto"><option value="'+"{$vvto['id']}"+'" price="'+"{$vvto['price']}"+'" <if condition="$vvto['id'] eq $pro_list[$j]['category_two']">selected</if>  pic="'+"{$product_id}"+'">'+"{$vvto['cat_name']}"+'</option></volist></select></li><li class="pidc"><label>'+"{:L('ProCate')}"+'：</label><select name="product_type_'+num+'" onchange="selelast(this)" style="width:100px;"><option value="">'+"{:L('ProCate')}"+'</option></select></li><li class="chuijin"><label>'+"{:L('Tax')}"+'（$）</label><label class="shuijinshow">0.00</label></li><li class="flaotl ordsmli amount"><label>{:L("Amount")}</label><input type="text" name="amount_'+num+'" class="clzhong"></li><li class="flaotl ordsmli"><label>{:L("UnitPrice")}</label><input type="text" name="price_'+num+'" class="clzhong"></li><li class="flaotl ordsmli"><label>{:L("Currency")}</label><select name="coin_'+num+'" id="" class="clduan"><option value="USD" selected="selected">$</option></select></li><li class="flaotl ordsmli marbot"><label>{:L("Remarks")}</label><input type="text" name="remark_'+num+'" class="clzhong"></li><div style="clear: both;"></div></ul>';
		$(".goodshow").append(str);
		$("#num").val(num);
	}
	// 一级分类
    function selecchang(obj){
        var no = $(obj).find('option:selected').val();
        //alert(no);
        if(no != ''){
            var text = $(obj).find("option:selected").text();
            $(obj).parent('li').prevAll('.brand').find('input').val(text);
        }else{
            $(obj).parent('li').prevAll('.brand').find('input').val('');
        }
        $.ajax({
            type: "GET",
            url: "{:U('Orderlist/next_level')}",
            data: "id="+no,
            success:function(data){
                $(obj).parent('li').next().children('select').find('option').remove();
                $(obj).parent('li').next().children('select').append("<option value=''>{:L('Cr_Select')}</option>");
                $.each(data, function (i, item) {  
                    $(obj).parent('li').next().children('select').append("<option value=" + item.id + " price="+ item.price +">" + item.cat_name + "</option>");//赋值
                }); 
            }
        });
    }
    // 二级分类
    function selectc(obj){
        var lsid = $(obj).find('option:selected').val();
        if(lsid != ''){
            var text = $(obj).find('option:selected').text();
            $(obj).parent('li').prevAll('.detail').find('input').val(text);            
        }else{
            $(obj).parent('li').prevAll('.detail').find('input').val('');
        }
        var tt =$(obj).parent().next('.pidc').children().attr('pid','{$product_id}');
        $.ajax({
            type: "GET",
            url: "{:U('Orderlist/product')}",
            data:"id="+lsid,
            success:function(data){
                $(obj).parent('li').next().children('select').find('option').remove();
                $(obj).parent('li').next().children('select').append("<option value=''>{:L('Cr_Select')}</option>");
                var picid = $(obj).children('option:selected').attr('pic');
                var text = '';
                $.each(data, function (i, item) {  
                    if(picid == item.id){
                        text += '<option value="' + item.id + '" selected>'+ item.name +'</option>';
                    }else{
                        text = '<option value="' + item.id + '">'+ item.name +'</option>';
                    }
                    $(obj).parent('li').next().children('select').append(text);//赋值
                });                 
            }
        });    
        var aminp = $(obj).parent('li').siblings('.amount').find('input');
        var sui = $(obj).parent('li').siblings('.chuijin').find('.shuijinshow');
        var gg = $(obj).find("option:selected").attr("price");
        var aipv = $(aminp).val();
        if(aipv != ''){
            var conts = (aipv*gg).toFixed(2);
            $(sui).html(conts);
        }else{
            $(sui).html(gg);
        }                   
        $(aminp).blur(function(){
            var inpn = $(this).val();
            //alert(sui);
            var cont = (inpn*gg).toFixed(2);
            $(obj).parent('li').siblings('.chuijin').find('.shuijinshow').html(cont);
        });

    }
    // 货品类别
    function selelast(obj){
        var no = $(obj).find('option:selected').val();
        if(no != ''){
            var text = $(obj).find('option:selected').text();
            $(obj).parent('li').prevAll('.catname').find('input').val(text);
        }else{
            $(obj).parent('li').prevAll('.catname').find('input').val('');
        }
    }
</script>