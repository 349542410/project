<!-- 在线下单 -->
<extend name="Member/base" />


<block name="main">
<script type="text/javascript" src="__MEMBER__/js/city/jquery.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/area.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/location.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/select2.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/select2_locale_zh-CN.js"></script>
<script src="__MEMBER__/js/cityselected.js"></script>
<link href="__MEMBER__/css/select2.css" rel="stylesheet"/>
<link href="__MEMBER__/css/index.css" rel="stylesheet">
<!-- <link href="__MEMBER__/css/one.css" rel="stylesheet">
<script src="__MEMBER__/js/add.js"></script> -->
<!-- <script type="text/javascript" src="__MEMBER__/js/city/city.js"></script>
<script type="text/javascript" src="__MEMBER__/js/city/edit.js"></script>-->
<style>

</style>
	<div class="warrp">
			<div class="fr wi940">
        <div class="he50 wddd">
            <div class="fl ddd-h2">
                <h2><span>充值中心</span></h2>
            </div>
        </div>
        <div class="aboutmoney mywallets" style="display:black">
            <div class="usermoney">
                <div class="usertop">
                    <h2>账户概况</h2>
                    <div class="usercontent">
                        <ul class="account-balance">
                            <li>
                                <div class="balance"><p>账户余额</p></div>
                                <div class="account"><h3>￥123213</h3></div>
                                <div class="topup">
                                    <span class="tuchong"><a  onclick="mywalletstopup()">充值</a></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="userc">
                        <ul>
                            <li><span>交易记录</span></li>
                        </ul>
                    </div>
                </div>
                <div class="userdown">
                    <div class="userdown-top">
                        <ul>								<!-- <if condition="$Request.param.type eq ''"> </if> 下面li的class状态-->
                            <a href="{:U('WebRecharge/index')}"><li class="alllist">充值记录</li></a>
                            <a href="{:U('Home/User/recharge',array('type'=>1))}"><li <if condition="$Request.param.type eq 1">class="alllist"</if>>订单记录</li></a>
                        </ul>
                    </div>
                    <hr style="height: 1px; background: #dedede; border: none; margin-top: -2px;" />
                    <if condition="$Request.param.type neq 1">
                    <div class="userdown-down recharge_log">
                        <div class="ttmt">
                            <ul>
                                <li>时间</li><li>状态</li><li>金额</li><li>支付方式</li>
                            </ul>
                        </div>
                        <div class="ttmt-list">
                            <ul>
                                <li>2017-5-11 15:20:00</li>
                                <li><if condition="$vo[pay_status] eq 0">待支付<else/>已支付</if></li>
                                <li>￥200</li>
                                <li>支付宝</li>
                            </ul>
                            <ul>
                                <li>2017-5-11 15:20:00</li>
                                <li><if condition="$vo[pay_status] eq 0">待支付<else/>已支付</if></li>
                                <li>￥200</li>
                                <li>支付宝</li>
                            </ul>
                            <ul>
                                <li>2017-5-11 15:20:00</li>
                                <li><if condition="$vo[pay_status] eq 0">待支付<else/>已支付</if></li>
                                <li>￥200</li>
                                <li>支付宝</li>
                            </ul>
                            <ul>
                                <li>2017-5-11 15:20:00</li>
                                <li><if condition="$vo[pay_status] eq 0">待支付<else/>已支付</if></li>
                                <li>￥200</li>
                                <li>支付宝</li>
                            </ul>
                            <ul>
                                <li>2017-5-11 15:20:00</li>
                                <li><if condition="$vo[pay_status] eq 0">待支付<else/>已支付</if></li>
                                <li>￥200</li>
                                <li>支付宝</li>
                            </ul>
                        </div>
                    </div>
                    <div class="recharge_log">{$page}</div>
                    <else/>
                   <div class="userdown-down consume_log">
                        <div class="ttmt">
                            <ul>
                                 <li>订单时间</li><li>金额</li><li>订单号</li>
                            </ul>
                        </div>
                        <div class="ttmt-list">
                            <ul>
                                <li>2017-5-11 15:20:00</li>
                                <li>￥200</li>
                                <li>Y135548521354</li>
                            </ul>
                        </div>
                    </div>
                    <div class="consume_log">{$page2}</div>
                    </if>
                </div>
            </div>
        </div>
        <div class="aboutmoney addmon" style="display:none">
            <div class="usermoney topup-money">
                <div class="userdown-top network-topup">
                    <ul>
                        <li class="alllist" style="margin-left: -1px">网银充值</li>
                    </ul>
                    <p onClick="mywalletsa();">返回充值中心</p>
                </div>
                <hr style="height: 1px; background: #dedede; border: none; margin-top: -2px;" />
                <div class="choicetu">
                    <p>选择充值金额：</p>
                    <div class="monettu">
                        <div class="fop-main">
                            <div class="m-tagbox m-multi-tag">

                                <a href="javascript:void(0)" rel="50" class="tag-item">￥50.00<i class="t-check tptig"></i></a>

                                <a href="javascript:void(0)" rel="100" class="tag-item">￥100.00<i class="t-check"></i></a>

                                <a href="javascript:void(0)" rel="200" class="tag-item">￥200.00<i class="t-check"></i></a>

                                <a href="javascript:void(0)" rel="500" class="tag-item">￥500.00<i class="t-check"></i></a>
                                
                                <div class="tag-define" data_id="tag_157">
                                    <span class="define-label" style="display: block;"><i class="i-pen"></i><em>输入金额</em></span>
                                    <input type="text" class="define-input" id="input_val" style="display: none;">
                                 </div>
                            </div>
                        </div>
                        <div class="fop-choice">
                            <form action="{:U('Topup/forsuccess')}" method="post" id="recharge_form">
                                <div class="orde-sjyy">
                                    <div class="bsjy-g">
                                        <dl>
                                            <dd>
                                             <div class="order-payment-area">
                                                 <div class="dsfzfpte">
                                                     <b>选择支付方式</b>                               
                                                 </div>
                                                 <div class="po-re dsfzf-ee">
                                                     <ul>   
                                                     	<li>
					                                    	<div class="payment-area">
					                                        	<input type="radio"  value="1" class="radio vam" name="paykind" <if condition="$k eq 'alipay'">checked</if>>
					                                            <label for="">
					                                            	<img src="__MEMBER__/image/winxinlogo.jpg" width="120" height="40" onClick="change_pay(this);" />
					                                            </label>
					                                        </div>
                                                         </li>                           
                                                         <li>
					                                    	<div class="payment-area">
					                                        	<input type="radio"  value="2" class="radio vam" name="paykind" <if condition="$k eq 'alipay'">checked</if>>
					                                            <label for="">
					                                            	<img src="__MEMBER__/image/zhifulogo.jpg" width="120" height="40" onClick="change_pay(this);" />
					                                            </label>
					                                        </div>
                                                         </li> 
                                                         <li>
					                                    	<div class="payment-area">
					                                        	<input type="radio"  value="3" class="radio vam" name="paykind" <if condition="$k eq 'alipay'">checked</if>>
					                                            <label for="">
					                                            	<img src="__MEMBER__/image/caifulogo.jpg" width="120" height="40" onClick="change_pay(this);" />
					                                            </label>
					                                        </div>
                                                         </li> 
                                                     </ul>
                                                 </div>
                                             </div>
                                            <!--第三方网银支付 start-->
<!--                                              <foreach name="bankCodeList" item="v"  key="k">
                                              <div class="order-payment-area">
                                                    <div class="dsfzfpte">
                                                       <b>{$paymentList[$k]['name']}</b>
                                                       <em>网银支付</em>
                                                    </div>
                                                    <div class="po-re dsfzf-ee">
                                                        <ul>
                                                        <foreach name="v" item="v2"  key="k2">
                                                          <li>
				                                            <div class="payment-area">
				                                                <input type="radio" name="pay_radio" class="radio vam" value="pay_code={$k}&bank_code={$v2}" id="input-ALIPAY-1">
				                                                <label for="">
				                                            	<img src="__STATIC__/images/images-out/{$bank_img[$k2]}" width="120" height="40" onClick="change_pay(this);"/>
				                                                </label>
				                                            </div>
                                                           </li>
                                                        </foreach>                                                               
                                                        </ul>
                                                    </div> 
                                                </div>
                                                </foreach>      -->              
                                            <!--第三方网银支付 end -->                             
                                            </dd>
                                        </dl>
                                        <input type="hidden" name="amount" id="add_money" value="50">
                                        <span id="out"></span>
                                        <div class="order-payment-action-area">                    
                                            <a class="button-style-5 button-confirm-payment" href="javascript:void(0);" onClick="recharge_submit()">确认支付方式</a>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>    
            </div>
        </div>
    </div>
	</div>
   	<script type="text/javascript">
   	$('#input_val').blur(function(){
   		var num=$("#input_val").val();
   		if(isNaN(num)){
   			alert("您输入的不是数字，请重新输入！");
   			return false;
   		}
   		var o=jqNumToMoney(num);
		$("#out").text(o);
   	});
   	// 数字金额转大写中文金额
   	function jqNumToMoney(n){
   		var fraction = ['角','分'];
   		var digit 	 = ['零','壹','贰','叁','肆','伍','陆','柒','捌','玖'];
   		var unit     = [['元','万','亿'],['','拾','佰','仟']];
   		var head     = n < 0?'欠':'';
   		n = Math.abs(n);
   		var s = '';
	   	for (var i = 0; i < fraction.length; i++) {  
			s += (digit[Math.floor(n * 10 * Math.pow(10, i)) % 10] + fraction[i]).replace(/零./, '');
		}
		s = s || '整';
		n = Math.floor(n);
		for (var i = 0; i < unit[0].length && n > 0; i++) {
			var p = '';
			for (var j = 0; j < unit[1].length && n > 0; j++) {
				p = digit[n % 10] + unit[1][j] + p;
				n = Math.floor(n / 10);
			}
			s = p.replace(/(零.)*零$/, '').replace(/^$/, '零') + unit[0][i] + s;
		}
		return head + s.replace(/(零.)*零元/,'元').replace(/(零.)+/g, '零').replace(/^整$/, '零元整');
   	}

    $(function () {
         $(".userdown-top ul li").click(function () {
            $(this).addClass('alllist').siblings().removeClass('alllist');
         });
    });
    
    function mywalletsa() {
        $('.mywallets').show();
        $('.addmon').hide();
    };
    function mywalletstopup() {
       $('.addmon').show();
       $('.mywallets').hide();
    };

    $(document).ready(function() {
        $(document).on('click','.tag-item',function(){
            $(this).find('.t-check').addClass('tptig').parent().siblings().find('.t-check').removeClass('tptig');  
            var o=jqNumToMoney($(this).attr('rel'));
			$("#out").text(o);
            $('#add_money').val($(this).attr('rel'));
        });
        $('.tag-define').click(function(){
            var goods_id = $(this).attr('data_id').substr(4);
            $(this).find('.define-label').hide();
            $(this).find('.define-input').show().focus();
            $(this).find('.define-input').blur(function(){
                var ce = $(this).val();
                ce = ce.replace(/\D|^0/g,'')                           
                $(this).parent('.tag-define').siblings('.tag-item').each(function(){
                    var a_text = $(this).text();
                    if(ce == a_text && ce != ''){
                        alert('已有该标签!');
                        ce = '';
                        $('.define-input').val('');
                    }
                });
                if(ce == ''){
                    $(this).prev('.define-label').show();
                    $(this).hide();
                }else{

                }
            })
        });
        
    });

    $(function () {
        //高亮显示
        var active = '{$active_status}';
        if(!active)
            active = 'ALL';
        $('.wddd-li li').removeClass('wddd-red');
        $('#'+active).addClass('wddd-red');

        $("#h-s").mouseover(function () {
            $('.ec-ta-x').css('left','124px');
            $('.ec-ta-x').css('width','110px');
            $(this).addClass("cullent");
        });
        $("#h-s").mouseout(function () {
            $('.ec-ta-x').css('left','0px');
            $('.ec-ta-x').css('width','124px');
            $(this).removeClass("cullent");
        });
        $("#q-s").mouseover(function () {
            $('.ec-ta-x').css('left','0px');
            $(this).addClass("cullent");
        });
        $("#q-s").mouseout(function () {
            $('.ec-ta-x').css('left','0px');
        });
    });
    
    function recharge_submit(){
    	var input_val = parseInt($('#input_val').val());
    	if(input_val>0){
    		$('#add_money').val(input_val);
    	}
    	var account = $('#add_money').val();
    	if(isNaN(account) || parseInt(account)<=0 || account==''){
    		alert('请输入正确的充值金额');
    		return false;
    	}
    	$.ajax({
	        cache: false,
	        type: "post",
	        url:"{:U('Topup/checkForm')}",
	        data:$('#recharge_form').serialize(),// 你的formid
	        async: false,
	        beforeSend:function(){
	            $("#loading").html('<img style="width:28px;height:28px;" src="__MEMBER__/images/msg_loading_d.gif"/>');
	        },
	        error: function(request) {
	            layer.alert("Connection error");
	        },
	        success: function(data) {
	            if(data.state == 'no'){
					layer.open({
						type: 0,
						offset: '300px',
						shadeClose: true,
						title: "{:L('LAY_SystemMessage')}",
						content : data.msg,
						icon : 5,
					});
	                  $("#loading").html('');
	            }else{
	               $('#recharge_form').submit();
	            }
	        }
	    });
    }
    
	// 选择 充值方式
	function change_pay(obj)
	{
		$(obj).parent().siblings('input[name="paykind"]').trigger('click');
	}		
	
   function switchTab(obj,showdiv){
   	$(obj).siblings().removeClass('alllist');
   	$(obj).addClass('alllist');
   	if(showdiv == 'recharge_log'){
   		$('.recharge_log').show();
   		$('.consume_log').hide();
   	}else{
   		$('.recharge_log').hide();
   		$('.consume_log').show();
   	}
   }
   	</script>
	<div class="foot"></div>

</block>

</body>
</html>